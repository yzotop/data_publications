---
tags:
  - data
data_type:
  - AB tests
link: https://habr.com/ru/companies/ozontech/articles/689052/
source: habr
author: Ozon
ab_type: AB_Platform
company: Ozon
---
ะะดะธะฝ ะธะท ะฒะฐะถะฝัั ะฒะพะฟัะพัะพะฒ ะบะฐะบ ะฒ ะฝะฐัะตะน ะถะธะทะฝะธ, ัะฐะบ ะธ ะฒ ะฑะธะทะฝะตัะต, ะธ ะฒ IT โ ะฒะพะฟัะพั ัััะตะบัะธะฒะฝะพััะธ. ะญััะตะบัะธะฒะฝะพ ะปะธ ะผั ะฟะปะฐะฝะธััะตะผ ะฝะฐัะต ะฒัะตะผั, ัะต ะปะธ ะทะฐะดะฐัะธ ัะตัะฐะตั ะฑะธะทะฝะตั, ัะพั ะปะธ ะบะพะด ะผั ะพะฟัะธะผะธะทะธััะตะผ? ะงัะพะฑั ะพัะฒะตัะธัั ะฝะฐ ััะธ ะฒะพะฟัะพัั,ย**ัะตะทัะปััะฐั**ยะดะพะปะถะตะฝ ะพะฑะปะฐะดะฐััย**ะณะปะฐะฒะฝัะผ ะบัะธัะตัะธะตะผ**ยโย**ะธะทะผะตัะธะผะพััั**.ยะะทะผะตัะธะผะพััั ัะตะทัะปััะฐัะฐ ะฝะพะฒัั ัะธั ะดะปั ะฑะธะทะฝะตัะฐ ะธ IT ะพะฑะตัะฟะตัะธะฒะฐะตัย**ะฟะปะฐััะพัะผะฐ**ย**ะ/B-ัะตััะพะฒ.**ยะ ัะพะผ, ะบะฐะบ ะตั ะผะพะถะฝะพ ะฟะพัััะพะธัั, ะฒัะดะตัะถะธะฒะฐัั ะฑะพะปััะพะน RPS ะธ ะฟัะธ ััะพะผ ะฝะตย~~ะพะฑะปะฐะถะฐัััั~~ยััะพะฝะธัั ะฟัะพะด, ั ัะฐััะบะฐะถั ะฒ ััะพะน ััะฐััะต.ย

ะ ะบะพะฝัะต ััะฐััะธ ะฒั ัะทะฝะฐะตัะต, ะบะฐะบ ะผั ะทะฐะดะตัะตะบัะธะปะธ ะฟัะพะฑะปะตะผัยะธะฝััะฐััััะบัััั, ะพะฟัะธะผะธะทะฐัะธั ะบะพัะพััั ะทะฝะฐัะธัะตะปัะฝะพ ะฟะพะฒะปะธัะปะฐ ะฝะฐ ัะบะพัะพััั ะฒัะตะณะพ Ozon.ย

![](https://habrastorage.org/r/w780q1/getpro/habr/upload_files/ce9/1b3/c04/ce91b3c0444c73dd1278857cd7b934e8.jpg)

## ะะตะท ะ/B, ะบะฐะบ ะธะทะผะตัะธัั ัะตะทัะปััะฐั ะฅะย

ะัะธะฒะตะดัะผ ะพะดะธะฝ ะธะท ัะฐะผัั ะธะฝัะตัะตัะฝัั ะธ ะพััะฐัะฝะฝัั ะฟัะธะผะตัะพะฒ ะ/B-ัะตััะพะฒ, ะบะพัะพััะน ะผะพะถะตั ะพัะฒะตัะธัั ะฝะฐ ะฒะพะฟัะพั, ะธะฝัะตัะตััััะธะน ะบะฐะบ IT, ัะฐะบ ะธ ะฑะธะทะฝะตั:ยย

โ ะะฐ ัะธะณะฐ ะผั ัะฟะฐััะฒะฐะตะผัั ั ะพะฟัะธะผะธะทะฐัะธะตะน ะฒัะตะผะตะฝะธ ะพัะฒะตัะฐ?ย

ะธะปะธยย

โ ะะฐะบ ัะบะพัะพััั ะพัะฒะตัะฐ ะฒะปะธัะตั ะฝะฐ ะดะตะฝัะณะธ?ยย

ะงัะพะฑั ะพัะฒะตัะธัั, ะผั ะผะพะถะตะผ ัะดะตะปะฐัั ัััะดัะฐััะธะน ัะตัั โ ะดะตะณัะฐะดะฐัะธั ัะบะพัะพััะธ ัะฐะนัะฐ (ัะปะฐะฑะพัะผะธะต ะธ ะพัะฒะฐะณะฐ) โ ะธ ะฟะพัะผะพััะตัั, ัะตะฐะปัะฝะพ ะปะธ ะฟัะพััะดัั ะดะตะฝะตะถะฝัะต ะผะตััะธะบะธ.ยย

ะกัะฐะฝะพะฒะธััั ะธะฝัะตัะตัะฝะตะต.ย

ะะฐะฒะฐะนัะต ะฟัะตะดััะฐะฒะธะผ, ััะพ ะผั ะดะตะปะฐะตะผ ัะธัั, ะฒ ะบะพัะพัะพะน, ะบ ะฟัะธะผะตัั, ะฝะฐ 100 ะผัย**ะทะฐะผะตะดะปัะตะผ**ยะฒะตัั ัะฐะนั, ะธ ัะพัะธะผ ะธะทะผะตัะธัั, ะบะฐะบ ััะพ ะฟะพะฒะปะธัะตั ะฝะฐ ะฝะฐั GMV (ะพะฑะพัะพั). ะกะฐะผัะน ะฟัะพััะพะน ะฒะฐัะธะฐะฝั: ะผั ะตั ะฟัะพััะพ ะฒัะบะฐััะฒะฐะตะผ ะฒ ะฟัะพะด ะธ ัะผะพััะธะผ, ะบะฐะบ ะผะตะฝััััั ะผะตััะธะบะธ.ย

#### ะะถะธะดะฐะฝะธะตย

ะะฐะบ ัะพะปัะบะพ ะผั ะฒะบะปััะธะผ ะฝะฐัั ัะธัั, ะฟัะพััะดัั ะฑะธะทะฝะตั-ะผะตััะธะบะธ:ย

![](https://habrastorage.org/r/w1560/getpro/habr/upload_files/3d4/9c9/352/3d49c9352dc134990087574bb3b90046.png)

#### ะะตะฐะปัะฝะพัััย

![](https://habrastorage.org/r/w1560/getpro/habr/upload_files/420/548/3ac/4205483ac35689dda0de3486c14981a1.png)

ะะตััะธะบะธ ะฟะพัะปะธ ะฒะฒะตัั! ย

![](https://habrastorage.org/r/w780q1/getpro/habr/upload_files/1b8/5c0/197/1b85c019733d8da2c20f6800bb66bd47.jpg)

ะะพะทะผะพะถะฝะพ, ะฟัะพััะพ ะฝะฐัััะฟะธะป ะฒััะพะบะธะน ัะตะทะพะฝ, ะธ ะฒััััะบะฐ ะทะฐ ัััั ัะฐัะฟัะพะดะฐะถ ััะฐะปะฐ ะฑะพะปััะต. ะะตะฟะพะฝััะฝะพ, ะฟะพะฒะปะธัะปะพ ะปะธ ะฝะฐ ััะพ ะฝะฐัะต ะทะฐะผะตะดะปะตะฝะธะต.ย

ะงัะพ ะถะต ะดะตะปะฐัั? ะะฐะบ ะธะทะผะตัะธัั? ะะฐ ะฟะพะผะพัั ะฟัะธัะพะดะธั ะบะพะผะฐะฝะดะฐ ะ/B-ัะตััะพะฒ ั ะดะตะฒะธะทะพะผ:ย

![](https://habrastorage.org/r/w1560/getpro/habr/upload_files/f62/edc/d47/f62edcd476ceefa4edd9d18ca7693084.png)

ะะพะถะฝะพ ะทะฐะฟัััะธัั ะ/B-ัะตัั โ ัะบัะฟะตัะธะผะตะฝั, ะฒ ะบะพัะพัะพะผ ะฝัะถะฝะพ ัะฐะทะดะตะปะธัั (ัะฟะปะธัะพะฒะฐัั) ะฟะพะปัะทะพะฒะฐัะตะปะตะน ะฝะฐ ะดะฒะต ะณััะฟะฟั. ะะตัะฒะพะน ะณััะฟะฟะต ะฒะบะปััะฐัั ะทะฐะผะตะดะปะตะฝะธะต (ัะตััะพะฒะฐั ะณััะฟะฟะฐ / ัะปะฐะฑะพัะผะธะต ะธ ะพัะฒะฐะณะฐ), ะฒัะพัะพะน ะณััะฟะฟะต โ ะฝะต ะทะฐะผะตะดะปััั (ะบะพะฝััะพะปัะฝะฐั ะณััะฟะฟะฐ).ยย

![](https://habrastorage.org/r/w1560/getpro/habr/upload_files/9f1/c40/114/9f1c40114e27014b6d70dcf35720b355.png)

ะะต ะทะฐะฑัะฒะฐะตะผ ัะฐะบะถะต ะดะพ ะทะฐะฟััะบะฐ ะพะฟัะตะดะตะปะธัั ะฝะตะพะฑัะพะดะธะผัะต ะฑะธะทะฝะตั-ะผะตััะธะบะธ ะธ ัะฐัััะธัะฐัั ะฟัะพะดะพะปะถะธัะตะปัะฝะพััั ัะบัะฟะตัะธะผะตะฝัะฐ. ะะพ ะทะฐะฒะตััะตะฝะธะธ ัะบัะฟะตัะธะผะตะฝัะฐ ะผั ะผะพะถะตะผ ััะฐะฒะฝะธัั ัะตะทัะปััะฐัั ะฒ ัะตััะพะฒะพะน ะธ ะบะพะฝััะพะปัะฝะพะน ะณััะฟะฟะฐั ะธ ะพะฟัะตะดะตะปะธัั, ะฑัะปะธ ะปะธ ััะฐัะธััะธัะตัะบะธ ะทะฝะฐัะธะผัะต ะธะทะผะตะฝะตะฝะธั ะธะปะธ ะฝะตั. Profit! ๐ย

ะญะบัะฟะตัะธะผะตะฝั ั ะทะฐะผะตะดะปะตะฝะธะตะผ ัะบะพัะพััะธ ะธะฝัะตัะตัะตะฝ ัะตะผ, ััะพ, ะทะฐะผะตะดะปัั ะฝะฐ ะพะฟัะตะดะตะปัะฝะฝะพะต ะฒัะตะผั ะฝะฐั ัะฐะนั, ะผั ะพะถะธะดะฐะตะผ, ััะพย**ะฟัะพััะดัั ะฑะธะทะฝะตั-ะผะตััะธะบะธ**, ะฐ ะฒย**ัะตะฐะปัะฝะพััะธ**ยััะพะณะพ ะผะพะถะตัย**ะฝะต ะฟัะพะธััะพะดะธัั**. ะ ะฟัะพะฒะพะดั ััะด ัะบัะฟะตัะธะผะตะฝัะพะฒ ั ัะฐะทะฝัะผ ะทะฐะผะตะดะปะตะฝะธะตะผ, ะผั ะผะพะถะตะผ ะพะฟัะตะดะตะปะธัั ัะพัะบั ัะปะฐััะธัะฝะพััะธ ัะบะพัะพััะธ ะพัะฒะตัะฐ โ ัะพัะบั, ะฝะฐัะธะฝะฐั ั ะบะพัะพัะพะน ะทะฐะผะตะดะปะตะฝะธะต ัะฐะนัะฐ ะฒะปะธัะตั ะฝะฐ ะดะตะฝัะณะธ. ะขะตะผ ัะฐะผัะผ ะฒั ะผะพะถะตัะต ะฝะฐะนัะธ ะบัะธัะธัะตัะบะพะต ะทะฝะฐัะตะฝะธะต ะทะฐะดะตัะถะบะธ, ะฟะพัะปะต ะบะพัะพัะพะณะพ ะผะพะถะตั ะฝะฐัะฐัััั ะฒะฐั ะปะธัะฝัะน ะัะผะฐะณะตะดะดะพะฝ (ะพ ะฝะฐัะตะผ ะัะผะฐะณะตะดะดะพะฝะต ัะฐััะบะฐะถั ะฝะธะถะต).ยย

ะขะฐะบะถะต ะผะพะณัั ะฑััั ะฟะพะปะตะทะฝั ะ/B-ัะตััั ะฝะฐ ัะฒะตะปะธัะตะฝะธะต ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ โ ััะพะฑั ะธะทะผะตัะธัั ัะฒะฝะพะต ะฒะปะธัะฝะธะต ะพะฟัะธะผะธะทะฐัะธะธ IT ะฝะฐ ะฑะธะทะฝะตั-ะผะตััะธะบะธ.ยย

> ะัะพัะธัะฐัั ะพะฑ ัะบัะฟะตัะธะผะตะฝัะฐั ั ะดะตะณัะฐะดะฐัะธะตะน ัะบะพัะพััะธ ะผะพะถะฝะพ ะฒ ะณะปะฐะฒะต 5 ยซะกะบะพัะพััั ะธะผะตะตั ะทะฝะฐัะตะฝะธะต**ยป**ยะบะฝะธะณะธ ยซ**ะะพะฒะตัะธัะตะปัะฝะพะต ะ/ะ-ัะตััะธัะพะฒะฐะฝะธะตยป**ยะะพัะฐะฒะธ ะ., ะขะฐะฝ ะ., ะกัะนยะฏ.ย

## ะ ัะตะผ ัะฟะตัะธัะธะบะฐ ะ/B-ัะตััะพะฒ?ย

ยะ/B-ัะตััั ะฝะฐัะพะดัััั ะฝะฐ ะฟะตัะตัะตัะตะฝะธะธ ัััั ะพะฑะปะฐััะตะน:ย

1. **ะะธะทะฝะตัะฐ**.ยะะธะทะฝะตัั ะฒะฐะถะฝะพ ะธะผะตัั ะธะฝััััะผะตะฝั ะฟัะพะฒะตัะบะธ ัะฒะพะธั ะณะธะฟะพัะตะท ะธ ะธะทะผะตัะตะฝะธั ัััะตะบัะธะฒะฝะพััะธ ะฝะพะฒัั ัะธั.ย
    
2. **ะะฝะฐะปะธัะธะบะธ**ย(ััะฐัะธััะธะบะธ). ะะตะพะฑัะพะดะธะผะพ ััะพัะผะธัะพะฒะฐัั ะผะตัะพะดะพะปะพะณะธั ะฟัะพะฒะตะดะตะฝะธั ัะบัะฟะตัะธะผะตะฝัะฐ, ะฒัะฑัะฐัั ะฝะตะพะฑัะพะดะธะผัะน ะฝะฐะฑะพั ะผะตััะธะบ, ะฒััะธัะปะธัั ะดะปะธัะตะปัะฝะพััั ัะบัะฟะตัะธะผะตะฝัะฐ, ะพะฟัะตะดะตะปะธัั ะบัะธัะตัะธะธ ััะฐัะธััะธัะตัะบะพะน ะทะฝะฐัะธะผะพััะธ ะดะปั ะบะฐะถะดะพะน ะธะท ะผะตััะธะบ.ย
    
3. **ะขะตัะฝะธัะตัะบะพะน ะพะฑะปะฐััะธ**. ะัะถะฝะพ ะพะฑะตัะฟะตัะธัั ะธะฝััะฐััััะบัััั ะดะปั ะฟัะพะฒะตะดะตะฝะธั ะ/B-ัะตััะพะฒ.ย  
    ย
    

![](https://habrastorage.org/r/w1560/getpro/habr/upload_files/ab0/2cb/232/ab02cb232d5aa969b265fe173fbdc889.png)

ะขะตัะฝะธัะตัะบัั ะพะฑะปะฐััั ะผะพะถะฝะพ ัะฐะทะดะตะปะธัั ะฝะฐ ะดะฒะต ัะพััะฐะฒะปัััะธะต:ย

![](https://habrastorage.org/r/w1560/getpro/habr/upload_files/309/b0b/b07/309b0bb07060a13d90f17423b1468b10.png)

1. **ะะปะฐััะพัะผะฐ ัะฟะปะธัะพะฒะฐะฝะธั ะฟะพะปัะทะพะฒะฐัะตะปะตะน.**ยะะฝะฐ ะฟัะตะดะพััะฐะฒะปัะตั ะฒะพะทะผะพะถะฝะพััั ะฒ ัะตะฐะปัะฐะนะผะต ะดะตะปะธัั ะฟะพะปัะทะพะฒะฐัะตะปะตะน ะฝะฐ ะณััะฟะฟั (ัะตััะพะฒัั ะธ ะบะพะฝััะพะปัะฝัั), ะพะฟัะตะดะตะปััั, ะฒ ะบะฐะบะธะต ัะบัะฟะตัะธะผะตะฝัั ะฟะพะฟะฐะป ะฟะพะปัะทะพะฒะฐัะตะปั, ะฒะพะทะฒัะฐัะฐั ะฒะบะปัััะฝะฝัะต ะดะปั ะฝะตะณะพ ัะธัะธ. ะกะธััะตะผะฐ ัะฟะปะธัะพะฒะฐะฝะธั ะฟะพะปัะทะพะฒะฐัะตะปะตะน ะพะฑะตัะฟะตัะธะฒะฐะตั ะฒัะดะตัะถะธะฒะฐะฝะธะต ะฑะพะปััะพะณะพ RPS, ะธะฝััััะผะตะฝัั ะธะฝัะตะณัะฐัะธะธ ั ััะพะฝัะตะฝะด- ะธ ะฑัะบะตะฝะด-ะผะธะบัะพัะตัะฒะธัะฐะผะธ, ะพัะฒะตัะฐะตั ะทะฐ ะทะฐะฟััะบ ะธ ะพััะฐะฝะพะฒะบั ัะบัะฟะตัะธะผะตะฝัะพะฒ ะธ ะฒัะฟะพะปะฝัะตั ะดััะณะธะต ััะฝะบัะธะธ.ย
    

2. **ะกัะตะฝะด ะผะตััะธะบ.**ยะะฝ ะพะฑะตัะฟะตัะธะฒะฐะตั ัะฐัััั ะผะตััะธะบ ะธะท ัะฐะทะฝัั ะธััะพัะฝะธะบะพะฒ ะดะฐะฝะฝัั, ะพะฑัะฐะฑะฐััะฒะฐั ัะตัะฐะฑะฐะนัั ะธะฝัะพัะผะฐัะธะธ, ะฒััะธัะปัะตั ะบัะธัะตัะธะธ ััะฐัะธััะธัะตัะบะพะน ะทะฝะฐัะธะผะพััะธ ะธ ะพัะดะฐัั ัะตะทัะปััะฐัั ัะบัะฟะตัะธะผะตะฝัะพะฒ.ย
    

ะ ััะพะน ััะฐััะต ัะตัั ะฟะพะนะดัั ะพ ะฟะปะฐััะพัะผะต ัะฟะปะธัะพะฒะฐะฝะธั ะฟะพะปัะทะพะฒะฐัะตะปะตะน. ะ ััะตะฝะดะต ะผะตััะธะบ, ะฝะฐะดะตััั, ะฒัะนะดะตั ะพัะดะตะปัะฝะฐั ััะฐััั.ย

## ะ ะฟะปะฐััะพัะผะต ะ/B-ัะตััะพะฒ ะฒ Ozonย

ะะฐัะตะน ะฟะปะฐััะพัะผะต ะ/B-ัะตััะพะฒ ัะตัััะต ะณะพะดะฐ. ะะฐ ััะพ ะฒัะตะผั ะพะฝะฐ ะฟัะพัะปะฐ ะฝะตัะบะพะปัะบะพ ััะฐะฟะพะฒ ะฒะทัะพัะปะตะฝะธั (ัะตัะฐะบัะพัะธะฝะณะฐ). ะะฐ ะพัะฝะพะฒะต ะฝะฐัะตะณะพ ะพะฟััะฐ ั ะพะฟะธัั ะฒะพะทะผะพะถะฝัะต ะฟะพะดัะพะดั ะบ ะฟะพัััะพะตะฝะธั ะฟะปะฐััะพัะผั ะ/B-ัะตััะพะฒ ะธ ะฝะฐัะธ ะธะฝัะฐะนัั ะฒ ะพะฑะปะฐััะธ ัะตัะตะฝะธั ะฟัะพะฑะปะตะผ, ั ะบะพัะพััะผะธ ะผั ััะฐะปะบะธะฒะฐะปะธัั ะฒะพ ะฒัะตะผั ัะบัะฟะปัะฐัะฐัะธะธ ะฟะปะฐััะพัะผั.ย

ะั ะผะพะถะตัะต ัะฒะธะดะตัั, ะบะฐะบ ะทะฐ ะฒัะตะผั ัััะตััะฒะพะฒะฐะฝะธั ะฟะปะฐััะพัะผัย**ะบัะฐัะฝะพ**ยะฒััะพัะปะพ ะบะพะปะธัะตััะฒะพ ัะบัะฟะตัะธะผะตะฝัะพะฒ โ ะธ, ัะพะพัะฒะตัััะฒะตะฝะฝะพ, ัะฒะตะปะธัะธะปะฐัั ะฝะฐะณััะทะบะฐ ะฝะฐ ะฑัะบะตะฝะด ะธ ะธะฝััะฐััััะบัััั:ย

![ะะพ ะฒะตััะธะบะฐะปัะฝะพะน ะพัะธ โ ะบะพะปะธัะตััะฒะพ ัะตััะพะฒ](https://habrastorage.org/r/w1560/getpro/habr/upload_files/dd7/f4d/4bb/dd7f4d4bb92c3f25b119045a3a595b89.png "ะะพ ะฒะตััะธะบะฐะปัะฝะพะน ะพัะธ โ ะบะพะปะธัะตััะฒะพ ัะตััะพะฒ")

ยะะพ ะฒะตััะธะบะฐะปัะฝะพะน ะพัะธ โ ะบะพะปะธัะตััะฒะพ ัะตััะพะฒย

ะะตัะฒัะผ ะบะปะธะตะฝัะพะผ ะฟะปะฐััะพัะผั ะ/B-ัะตััะพะฒ ะฒ 2019 ะณะพะดั ััะฐะปะฐ ะฝะฐัะฐ ะบะพะผะฐะฝะดะฐ, ะบะพะณะดะฐ ะผั ะทะฐะฟััะบะฐะปะธ ััะฐะฒะฝะตะฝะธะต ัะตะบะพะผะตะฝะดะฐัะตะปัะฝัั ะฐะปะณะพัะธัะผะพะฒ. ะะพะผะฝั, ะบะฐะบ ัะตะฑััะฐ ะธะท Data Science ะดัะผะฐะปะธ, ััะพ ัะตะนัะฐั ะฑัะดะตั ััะฟะตัะฟััะบะฐ-ะฐะปะณะพัะธัะผ, ะทะฐะฟััะบะฐะปะธ ัะตัั, ะฐ ััะฐัะธััะธัะตัะบะธ ะทะฝะฐัะธะผัั ัะตะทัะปััะฐัะพะฒ ัะฐััะพ ะฝะต ะฝะฐะฑะปัะดะฐะปะธ. ะ ััะพ ะฑัะปะพ ัะพัะพัะธะผ ััะธะผัะปะพะผ ะดะปั ัะปัััะตะฝะธั ะฝะฐัะธั ัะตะบะพะผะตะฝะดะฐัะธะน.ย

ะัะปะธ ะฟะพัะผะพััะตัั ะฝะฐ ะณัะฐัะธะบ ะฒััะต, ะผะพะถะฝะพ ะทะฐะผะตัะธัั, ััะพ ะฒ ะฐะฟัะตะปะต ััะพะณะพ ะณะพะดะฐ ะฑัะปะพ ะทะฐะฟััะตะฝะพ ะฑะพะปะตะตย**100 ัะบัะฟะตัะธะผะตะฝัะพะฒ**. ะ ะธั ััะฐะฝะพะฒะธััั ัะพะปัะบะพ ะฑะพะปััะต. ะญัะพ ะฟัะพะธััะพะดะธั ะฝะต ัะพะปัะบะพ ะฑะปะฐะณะพะดะฐัั ะฒััะพะบะพะน ัะบะพัะพััะธ ะพัะฒะตัะฐ ะฟะปะฐััะพัะผั ะ/B-ัะตััะพะฒ, ัะดะพะฑะฝะพะน ะธะฝัะตะณัะฐัะธะธ ะธ ั. ะด., ะฝะพ ัะฐะบะถะต ะฒัะปะตะดััะฒะธะต ัะพะณะพ, ััะพ ะผะตะฝััััั ะฟัะพัะตััั ะฒ ะบะพะผะฟะฐะฝะธะธ. ะะพ ััะพ ัะถะต ัะพะฒัะตะผ ะดััะณะฐั ะธััะพัะธั...ย

## ะะฐะบ ะฟะพัััะพะธัั ะฟะปะฐััะพัะผั ะ/B-ัะตััะพะฒ?ย

ยะะฐะปะตะต ั ัะฐััะบะฐะถั ะพ ะฟะพะดัะพะดะฐั, ะธัะฟะพะปัะทัั ะบะพัะพััะต ะผะพะถะฝะพ ะฟะพัััะพะธัั ะฟะปะฐััะพัะผั ะ/B-ัะตััะพะฒ. ะั ัะฐััะผะพััะธะผ ะธั ะผะธะฝััั ะธ ะฟะพะนะผัะผ, ะบะฐะบ ะฟัะธะนัะธ ะบ ยซะธะดะตะฐะปัะฝะพะนยป ะฐััะธัะตะบัััะต ะ/B-ัะตััะพะฒ. ย

ะะปั ััะพะณะพ ะพะฑัะฐัะธะผัั ะบ ะธััะพัะธะธ.ย

![](https://habrastorage.org/r/w1560/getpro/habr/upload_files/d69/796/50a/d6979650a3ae202bfc0386603e0b90fd.png)

C ัะตะณะพ ะฒัั ะฝะฐัะธะฝะฐะปะพัั?ย

ะ ะฝะฐัะธะฝะฐะปะพัั ะฒัั, ะบะฐะบ ะฒะพะดะธััั, ั Exัel-ะบะธ. ะ ะฝะตะน ะฑัะปะฐ ะธะฝัะพัะผะฐัะธั ะพะฑะพ ะฒัะตั ะทะฐะฟััะตะฝะฝัั ัะบัะฟะตัะธะผะตะฝัะฐั ะดะปั ััะบะพะฒะพะดะธัะตะปั ะบะพะผะฐะฝะดั ะฐะฝะฐะปะธัะธะบะธ. ะะฐะบ ะธะทะฒะตััะฝะพ, ะดะตะนััะฒะธัะตะปัะฝะพััั ะผะพะถะตั ะพัะปะธัะฐัััั ะพั ะพะถะธะดะฐะฝะธะน, ะฐ ะบะพะฝัะธะณ ะฑัะบะตะฝะดะฐ ั ัะตะฐะปัะฝะพ ะทะฐะฟััะตะฝะฝัะผะธ ัะบัะฟะตัะธะผะตะฝัะฐะผะธ โ ะพั ะฟัะตะบัะฐัะฝะพะน Exัel-ะบะธ. ย

![](https://habrastorage.org/r/w1560/getpro/habr/upload_files/c42/ed4/e84/c42ed4e84bfa26b7bf05e6bf52998150.png)

ะะตะบะพัะพััะต ะฟัะพะดัะบั ะพัะฝะตัั ะผะพะณะปะธ ะฟัะพะฒะพะดะธัั ัะบัะฟะตัะธะผะตะฝัั, ะพ ะบะพัะพััั ะฝะต ะทะฝะฐะป ะณะปะฐะฒะฐ ะบะพะผะฐะฝะดั ะฐะฝะฐะปะธัะธะบะธ. ะญัะธ ยซะฟะพะดะฟะพะปัะฝัะตยป ัะบัะฟะตัะธะผะตะฝัั ะผะพะณะปะธ ะพะบะฐะทัะฒะฐัั ะฒะปะธัะฝะธะต ะฝะฐ ะฑะธะทะฝะตั-ะผะตััะธะบะธ ะดััะณะธั ัะบัะฟะตัะธะผะตะฝัะพะฒ โ ะธ ะพะฑ ััะพะผ ะฝะต ะทะฝะฐะปย**ะฝะธะบัะพ**.ย

ะัะธะบะพะป ะฒ ัะพะผ, ััะพยัะฐะนะป ั ะบะพะฝัะธะณะพะผ ัะบัะฟะตัะธะผะตะฝัะพะฒ ะฑัะป ะฝะต ะพะดะธะฝ, ะฐ ะธั ะฑัะปะพ ะดะฒะฐ. ะัะป ะตัั ะพะดะธะฝ ะดะปั ะผะพะฑะธะปัะฝัั ะฟัะธะปะพะถะตะฝะธะน โ ะธ ัะธะฝััะพะฝะธะทะธัะพะฒะฐัั ััะธ Excel-ะบะธ ะดะปั ะฐะฝะฐะปะธัะธะบะธ ัะบัะฟะตัะธะผะตะฝัะพะฒ Ozon ะฑัะปะพ ะฑะพะปัะฝะพ. ย

![](https://habrastorage.org/r/w1560/getpro/habr/upload_files/49a/1d2/dc4/49a1d2dc4e8609c39281a04101c6c78c.png)

ะขะฐะบะถะต ะธะท ะพัะฝะพะฒะฝัั ะฟัะพะฑะปะตะผ ะผะพะถะฝะพ ะฒัะดะตะปะธัั ัะพ, ััะพ ะฝะต ะฑัะปะพ ะตะดะธะฝะพะณะพ ััะฐะฝะดะฐััะฐ ััะตัะฐ ัะบัะฟะตัะธะผะตะฝัะพะฒ (ะพะฟะธัะฐะฝะธั ะธั ัะตะปะตะน, ะผะตััะธะบ ะธ ั. ะด.), ะธั ัะตะฐะปัะฐะนะผ-ะทะฐะฟััะบะฐ ะธ ะพััะฐะฝะพะฒะบะธ, ะธััะพัะธะธ ะทะฐะฟััะบะพะฒ ะธ ะฒะพะทะผะพะถะฝะพััะธ ะทะฐะฟััะบะฐ ะผัะปััะธัะตัะฒะธัะฝัั ัะบัะฟะตัะธะผะตะฝัะพะฒ.ย

ะะปั ัะพะณะพ ััะพะฑั ะพะฟัะตะดะตะปะธัััั, ะบะฐะบ ัะตัะธัั ััะธ ะฟัะพะฑะปะตะผั ะธ ะฟะพัััะพะธัั ะ/B-ะฟะปะฐััะพัะผั ะผะตััั, ะดะฐะฒะฐะนัะต ัะฐััะผะพััะธะผ ะฒะพะทะผะพะถะฝัะต ะฒะฐัะธะฐะฝัั ะตั ะฐััะธัะตะบัััั.ย

## OldSchool ะผะพะฝะพะปะธั ย

ะกะฐะผัะน ะฟัะพััะพะน ัะฟะพัะพะฑ ะฟะพัััะพะตะฝะธั ะฟะปะฐััะพัะผั ะ/B-ัะตััะพะฒ, ะบะพัะพััะน ะธััะพัะธัะตัะบะธ ะฑัะป ะฒ Ozon, ะบะฐะบ ะธ ะฒะพ ะฒัะตั ะบะพะผะฟะฐะฝะธัั ัะพะณะพ ะฒัะตะผะตะฝะธ โ ััะพ ะฐััะธัะตะบัััะฐ ะธะท 90-ั ะธ ััะพ ะบะพะฝะตัะฝะพ ะถะต ะผะพะฝะพะปะธั. ย

![](https://habrastorage.org/r/w1560/getpro/habr/upload_files/0d8/739/9ec/0d87399ec696586635fca759cf45dd2e.png)

ะะพะปัะทะพะฒะฐัะตะปั ะฟัะธ ะทะฐะฟัะพัะต ัะพะบะตะฝะฐ ะฐะฒัะพัะธะทะฐัะธะธ ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฟะพะปััะฐะตั ะ/B-ะณััะฟะฟั ะบะฐะบ ัะฐะฝะดะพะผ ั ัะฐะฒะฝะพะผะตัะฝัะผ ัะฐัะฟัะตะดะตะปะตะฝะธะตะผ ะพั 0 ะดะพ 99. ย

> `abGroup = random % 100`ย

ะััะฑะพ ะณะพะฒะพัั, ะฟะพะปัะทะพะฒะฐัะตะปั ะฟัะธัะฒะฐะธะฒะฐะตััั ะฟัะพัะตะฝั ัะฐัะฟัะตะดะตะปะตะฝะธั, ะฒ ะบะพัะพััะน ะพะฝ ะฟะพะฟะฐะป ะฟัะธ ะฐะฒัะพัะธะทะฐัะธะธ. ะะฐะปะตะต ััะพั ะฟัะพัะตะฝั ัะพััะฐะฝัะตััั ะฒ ะบัะบะฐั ะธ ะฟะตัะตะดะฐัััั ั ััะพะฝัะฐ ะฒ ะบะฐะถะดะพะผ ะทะฐะฟัะพัะต.ยย

ะัะบะตะฝะด-ะผะพะฝะพะปะธั ะฟัะธ ััะฐััะต ัะธัะฐะตั ะบะพะฝัะธะณ ั ัะบะฐะทะฐะฝะธะตะผ ะฝะฐะฑะพัะฐ ัะธั ะธ ัะบะฐะทะฐะฝะธะตะผ, ะดะปั ะบะฐะบะพะณะพ ะฟัะพัะตะฝัะฐ ะฟะพะปัะทะพะฒะฐัะตะปะตะน (ะฝะฐะฑะพัะฐ ะ/B-ะณััะฟะฟ) ะฒะบะปััะฐะตััั ะบะฐะถะดะฐั ัะธัะฐ.ย

ะะพะปััะฐั ะ/B-ะณััะฟะฟั ะธะท ะบัะบ, ะฑัะบะตะฝะด ะพะฟัะตะดะตะปัะตั, ะบะฐะบะพะน ะฝะฐะฑะพั ัะธั ะฒะบะปัััะฝ ะดะปั ะดะฐะฝะฝะพะณะพ ะฟะพะปัะทะพะฒะฐัะตะปั. ะะฐ ะฟัะธะผะตัะต ะบะพะฝัะธะณะฐ ะฝะธะถะต: ะตัะปะธ ะฝะฐะผ ะฟัะธ ะฐะฒัะพัะธะทะฐัะธะธ ะฒัะดะฐะปะธ 40-ั ะ/B-ะณััะฟะฟั, ัะพ ะฝะฐะผ ะฒะตัะฝัะปััยัะปะตะดัััะธะน ะฝะฐะฑะพั ัะธั:ย`abGroupNewCheckout`ย(ัะฐะบ ะบะฐะบ ะตะน ัะพะพัะฒะตัััะฒัะตั ะฝะฐะฑะพั ะ/B-ะณััะฟะฟ ั 35-ะน ะฟะพ 65-ั) ะธย`DeliveryVariant_1`ย(ัะฐะบ ะบะฐะบ ะตะน ัะพะพัะฒะตัััะฒัะตั ะฝะฐะฑะพั ะ/B-ะณััะฟะฟ ะฒ ะธะฝัะตัะฒะฐะปะต ั 40-ะน ะดะพ 54-ะน).ย

ะัะธะผะตั ะบะพะฝัะธะณะฐ:ยย

```
<?xml version="1.0" encoding="UTF-8"?> <config>    <!-- A/B-ะณััะฟะฟั ะดะปั ะฝะพะฒะพะณะพ ัะตะบะฐััะฐ -->    <add key="abGroupNewCheckout" value=โ 35-65" />    <!-- A/B-ะณััะฟะฟั ะดะปั ัะฐัะธัะฝะพะน ะฟะพะดัะบะฐะทะบะธ ะฝะฐ ัััะฐะฝะธัะต ะฒัะฑะพัะฐ ัะฟะพัะพะฑะฐ ะดะพััะฐะฒะบะธ-->    <add key="DeliveryVariant_1" value="40-54" />    <add key="DeliveryVariant_2" value="55-69" />    <add key="DeliveryVariant_3" value="15-19,70-79" />    <add key="DeliveryVariant_4" value="0-14" />    <!-- A/B-ะณััะฟะฟั ะดะปั ะฟัะพะฟััะบะฐ ัััะฐะฝะธัั region ะดะปั ะฟะพะปัะทะพะฒะฐัะตะปะตะน, ั ะบะพัะพััั ะฝะตั ัะพััะฐะฝัะฝะฝัั ะฐะดัะตัะพะฒ -->    <add key="AbGroupSkipRegionPageForNewUsers" value="0-40,60-100,500" /> </config>
```

**ะะพะปั**:ยะพัะตะฝั ะฝะตัะดะพะฑะฝะพ ะดะตะฟะปะพะธัั ะพะณัะพะผะฝัะน ะผะพะฝะพะปะธั, ััะพะฑั ะฒะบะปััะธัั ะธะปะธ ะฒัะบะปััะธัั ะฝะตะฑะพะปัััั ัะธัั.ย

ะะฐะฒะฐะนัะต ัะตะฟะตัั ะฟัะตะดััะฐะฒะธะผ, ััะพ ะผั ะฟะตัะตะฝะตัะปะธัั ะธะท 90-ั โ ะธ ั ะฝะฐั ัะถะต ะฝะต ะผะพะฝะพะปะธั, ะฐย**ัะพะฒัะตะผะตะฝะฝะฐั**ยะผัะปััะธัะตัะฒะธัะฝะฐั ะฐััะธัะตะบัััะฐ.ย

## ะะพะปะพะดัะถะฝะฐั ะผัะปััะธัะตัะฒะธัะฝะฐั ะฐััะธัะตะบัััะฐ ย

ะะฐััะผะพััะธะผ ะตั ะฝะฐ ะฟัะธะผะตัะต ะพัะพะฑัะฐะถะตะฝะธั ะบะฐััะพัะบะธ ัะพะฒะฐัะฐ:ย

![](https://habrastorage.org/r/w1560/getpro/habr/upload_files/967/930/0f2/9679300f22dd343eca3a6e36eaecf195.png)

ะะฐะฟัะพัั ะฟะพะปัะทะพะฒะฐัะตะปะตะน ัะฝะฐัะฐะปะฐ ะธะดัั ะฝะฐ ัะปัะท Ozon. ะะฐะปะตะต ะฝะฐ ัะปัะทะต ะพะฟัะตะดะตะปัะตััั, ะฝะฐ ะบะฐะบะพะน ะฑัะบะตะฝะด ะฝัะถะฝะพ ะฟะพะนัะธ, ััะพะฑั ะพััะธัะพะฒะฐัั ัััะฐะฝะธัั. ะ ะฝะฐัะตะผ ะฟัะธะผะตัะต ัะปัะท ะธะดัั ะฒ ัะตัะฒะธัั: PDP (product detail page), ัะตะบะพะผะตะฝะดะฐัะตะปัะฝัะน ะธยะพัะทัะฒั. ะั ััะพั ะฑัะบะตะฝะด ะฝะฐะทัะฒะฐะตะผ ะฑัะบะตะฝะดะพะผ ะฟะตัะฒะพะณะพ ััะพะฒะฝั ะฟะพ ัะดะฐะปัะฝะฝะพััะธ ะพั gateway.ย

ะะฐะปะตะต ะดะปั ัะพะณะพ ััะพะฑั ะฟะพะปััะธัั ะดะพะฟะพะปะฝะธัะตะปัะฝัั ะธะฝัะพัะผะฐัะธั, ะฑัะบะตะฝะด ะฟะตัะฒะพะณะพ ััะพะฒะฝั ะธะดัั ะฒ ะฑัะบะตะฝะด ะฒัะพัะพะณะพ ััะพะฒะฝั. ะ ะฝะฐัะตะผ ะฟัะธะผะตัะต ัะตัะฒะธั Recoms (ัะตัะฒะธั ะฟะตัะฒะพะณะพ ััะพะฒะฝั) ะทะฐะฟัะฐัะธะฒะฐะตั ัะตะฝั ัะตะบะพะผะตะฝะดัะตะผัั ัะพะฒะฐัะพะฒ ั price-api (ัะตัะฒะธั ะฒัะพัะพะณะพ ััะพะฒะฝั) ะธ ะพะฟะธัะฐะฝะธะต ัะพะฒะฐัะพะฒ โ ั product service (ัะตัะฒะธั ะฒัะพัะพะณะพ ััะพะฒะฝั). ย

ะะฐะปะพะถะธะผ ะฟะฐััะตัะฝ ั ะปะพะบะฐะปัะฝัะผ ะบะพะฝัะธะณะพะผ ะธ ะ/B-ะณััะฟะฟะพะน ะธะท 90-ั ะฝะฐ ะผะพะปะพะดัะถะฝัั ะผัะปััะธัะตัะฒะธัะฝัั ะฐััะธัะตะบัััั โ ะธ ะฟะพะปััะธะผ ัะปะตะดัััะตะต ัะตัะตะฝะธะต: ยย

![](https://habrastorage.org/r/w1560/getpro/habr/upload_files/f15/40b/953/f1540b953dae4d8764b5539d8ddc98a5.png)

ะัะบะตะฝะด ะฟะตัะฒะพะณะพ ะธ ะฒัะพัะพะณะพ ััะพะฒะฝะตะน ะฟัะธ ััะฐััะต ะทะฐะณััะถะฐัั ะบะพะฝัะธะณ ั ะฝะฐัััะพะนะบะพะน ัะบัะฟะตัะธะผะตะฝัะพะฒ ะฟะพ ะ/B-ะณััะฟะฟะฐะผ. ย

ะัะธ ะพะฑัะฐัะตะฝะธะธ ะฟะพะปัะทะพะฒะฐัะตะปั ะบ ัะฐะนัั ะฒ ะผะพะผะตะฝั ะฐะฒัะพัะธะทะฐัะธะธ ะพะฝ ะฟะพะปััะฐะตั ะ/B-ะณััะฟะฟั. ะคัะพะฝัะตะฝะดยะฟะตัะตะดะฐัั ะตั ะฒ gateway, gateway, ะฟัะพะบัะธััั ะทะฐะฟัะพัั, ะฟะตัะตะดะฐัั ะ/B-ะณััะฟะฟั ะฒ ะฑัะบะตะฝะด ะฟะตัะฒะพะณะพ ััะพะฒะฝั. ะัะบะตะฝะด ะฟะตัะฒะพะณะพ ััะพะฒะฝั ะฟะพ ะ/B-ะณััะฟะฟะต ะพะฟัะตะดะตะปัะตั ะฝะฐะฑะพั ะฒะบะปัััะฝะฝัั ัะธั, ะฟะตัะตะดะฐัั ะ/B-ะณััะฟะฟั ะฒ ะฑัะบะตะฝะด ะฒัะพัะพะณะพ ััะพะฒะฝั, ะบะพัะพััะน ะฟะพ ะฝะตะน ัะพะถะต ะพะฟัะตะดะตะปัะตั ะฝะฐะฑะพั ะฒะบะปัััะฝะฝัั ัะธั. ย

**ะะธะฝััั ััะพะณะพ ะฟะพะดัะพะดะฐ:**ย

- ะฝะตั ะธััะพัะธะธ ัะบัะฟะตัะธะผะตะฝัะพะฒ;ย
    
- ะฝะตั ะฒะพะทะผะพะถะฝะพััะธ ะฟะปะฐะฝะธัะพะฒะฐัั ัะบัะฟะตัะธะผะตะฝัั;ย
    
- ะธะฝัะพัะผะฐัะธั ะพะฑ ัะบัะฟะตัะธะผะตะฝัะฐั ัะฐะทัะพะทะฝะตะฝะฐ;ย
    
- ะฝะตั ะฒะพะทะผะพะถะฝะพััะธ ะพััะฐะฝะพะฒะบะธ/ะทะฐะฟััะบะฐ ัะบัะฟะตัะธะผะตะฝัะพะฒ ะฒ ัะตะฐะปัะฐะนะผะต: ะพััะฐะฝะพะฒะบะฐ/ะทะฐะฟััะบ ะฟัะพะธะทะฒะพะดะธััั ัะพะปัะบะพ ัะตัะตะท ะดะตะฟะปะพะน, ัะฐะบ ะบะฐะบ ะดะปัยััะธั ะพะฟะตัะฐัะธะน ะฝัะถะฝะพ ะผะตะฝััั ะบะพะฝัะธะณ ะธ ัะตััะฐััะธัั ัะตัะฒะธัั;ย
    
- ะฟะพะปัะทะพะฒะฐัะตะปะธ ะผะพะณัั ะฝะตัะฐะฒะฝะพะผะตัะฝะพ ัะฐัะฟัะตะดะตะปััััั ะผะตะถะดั ัะบัะฟะตัะธะผะตะฝัะฐะผะธ, ัะฐะบ ะบะฐะบ ะพะดะฝะฐ ะธ ัะฐ ะถะต ะ/B-ะณััะฟะฟะฐ ะธัะฟะพะปัะทัะตััั ะดะปั ัะฐะทะฝัั ัะบัะฟะตัะธะผะตะฝัะพะฒ;ย
    
- ะฝะตั ะฒะพะทะผะพะถะฝะพััะธ ะทะฐะดะฐะฒะฐัั ััะปะพะฒะธั ะฟะพะฟะฐะดะฐะฝะธั ะฟะพะปัะทะพะฒะฐัะตะปะตะน ะฒ ัะบัะฟะตัะธะผะตะฝัั.ย
    

ะะดะธะฝ ะธะท ะบะปััะตะฒัั ะผะธะฝััะพะฒ โ ะพััััััะฒะธะต ะฒะพะทะผะพะถะฝะพััะธ ะทะฐะฟััะบะฐ/ะพััะฐะฝะพะฒะบะธ ัะบัะฟะตัะธะผะตะฝัะฐ ะฒ ัะตะฐะปัะฐะนะผะต. ย

## EventDream

ะะปั ัะพะณะพ ััะพะฑั ัะตัะธัั ะฟัะพะฑะปะตะผั ั ัะตะฐะปัะฐะนะผะพะผ, ะผั ะผะพะถะตะผ ัะดะตะปะฐัั ัะตัะฒะธัย`ab-test-api`, ะบะพัะพััะน ะฑัะดะตั ะพะฟะพะฒะตัะฐัั ัะตัะฒะธัั ะพ ะทะฐะฟััะบะต ัะบัะฟะตัะธะผะตะฝัะพะฒ ะธ ะธั ะพััะฐะฝะพะฒะบะต.ย

![](https://habrastorage.org/r/w1560/getpro/habr/upload_files/ce3/34c/83b/ce334c83bbc1f8ceb4c7f1c054a7803f.png)

ะะพะณะธะบะฐ ัะฐะบะฐั ะถะต, ะบะฐะบ ะฒ ะฟะพะดัะพะดะต ะฒััะต, ัะพะปัะบะพ ะธะฝัะพัะผะฐัะธั ะพะฑ ัะบัะฟะตัะธะผะตะฝัะฐั ะผะพะถะตั ะปะตะณะบะพ ะพะฑะฝะพะฒะปััััั ะธ ะฒัะตะณะดะฐ ะฐะบััะฐะปัะฝะฐั.ย

ะะดะฝะฐะบะพ ะพััะฐะปะธัั ะดััะณะธะต ะผะธะฝััั:ย

- ะฝะตั ะธััะพัะธะธ ัะบัะฟะตัะธะผะตะฝัะพะฒ;ย
    
- ะฝะตั ะฒะพะทะผะพะถะฝะพััะธ ะฟะปะฐะฝะธัะพะฒะฐัั ัะบัะฟะตัะธะผะตะฝัั;ย
    
- ะธะฝัะพัะผะฐัะธั ะพะฑ ัะบัะฟะตัะธะผะตะฝัะฐั ัะฐะทัะพะทะฝะตะฝะฐ;ย
    
- ะฟะพะปัะทะพะฒะฐัะตะปะธ ะผะพะณัั ะฝะตัะฐะฒะฝะพะผะตัะฝะพ ัะฐัะฟัะตะดะตะปััััั ะผะตะถะดั ัะบัะฟะตัะธะผะตะฝัะฐะผะธ, ัะฐะบ ะบะฐะบ ะพะดะฝะฐ ะธ ัะฐ ะถะต ะ/B-ะณััะฟะฟะฐ ะธัะฟะพะปัะทัะตััั ะดะปั ัะฐะทะฝัั ัะบัะฟะตัะธะผะตะฝัะพะฒ;ย
    
- ะฝะตั ะฒะพะทะผะพะถะฝะพััะธ ะทะฐะดะฐะฒะฐัั ััะปะพะฒะธั ะฟะพะฟะฐะดะฐะฝะธั ะฟะพะปัะทะพะฒะฐัะตะปะตะน ะฒ ัะบัะฟะตัะธะผะตะฝัั.ย
    

ะะฐั ััะพ ะฝะต ะพัะตะฝั ััััะฐะธะฒะฐะตั, ะฟะพััะพะผั ะฟะพะฟัะพะฑัะตะผ ะดััะณะพะน ะฟะพะดัะพะด, ะบะพัะพััะน ัะตัะธั ััะฐะทั ััะธ ะฟัะพะฑะปะตะผั. ะ ััะพั ะฟะพะดัะพะด ะบะพะฝะตัะฝะพ ะถะต...

## Single Responsibility

ะ ััะพะผ ะฟะพะดัะพะดะต ะผั ะฑัะดะตะผ ะธัะฟะพะปัะทะพะฒะฐัั ะฐััะธัะตะบัััั, ะฒ ะบะพัะพัะพะน ัะตะฝััะฐะปัะฝัะผ ัะตัะฒะธัะพะผ ะฑัะดะตัย`ab-test-api`. ย

ะคัะฝะบัะธะธ ััะพะณะพ ัะตัะฒะธัะฐ:ย

- ััะฐะฝะธัั ะธะฝัะพัะผะฐัะธั ะพะฑะพ ะฒัะตั ัะบัะฟะตัะธะผะตะฝัะฐั ั ะธััะพัะธะตะน ะดะปั ะฒัะตั ัะตัะฒะธัะพะฒ;ย
    
- ะพัะดะฐะฒะฐัั ะดะปั ะบะฐะถะดะพะณะพ ัะตัะฒะธัะฐ ะฝะฐะฑะพั ะฒะบะปัััะฝะฝัั ัะธั.ย
    

![](https://habrastorage.org/r/w1560/getpro/habr/upload_files/2bf/997/140/2bf997140963266d8298cbadb1ef8477.png)

ะะฑัะฐั ะปะพะณะธะบะฐ ั ะ/B-ะณััะฟะฟะพะน ะพััะฐัััั ะฝะตะธะทะผะตะฝะฝะพะน, ัะพะปัะบะพ ัะตะฟะตัั ะฑัะบะตะฝะด ะดะปั ะฟะพะปััะตะฝะธั ะดะฐะฝะฝัั ะพ ะฝะฐะฑะพัะต ะฒะบะปัััะฝะฝัั ัะธั ะฑัะดะตั ะธะดัะธ ะฒ ัะตัะฒะธัย`ab-test-api`, ะฟะตัะตะดะฐะฒะฐั ะฒ ะฝะตะณะพ A/B-ะณััะฟะฟั. ย

ะขะฐะบะธะผ ะพะฑัะฐะทะพะผ, ะฒ ะบะฐะถะดะพะผ ะธะท ัะตัะฒะธัะพะฒ ัะฐะผะพััะพััะตะปัะฝะพ ะฝะต ะฝัะถะฝะพ ะพะฟัะตะดะตะปััั, ะบะฐะบะฐั ัะธัะฐ ะฒะบะปััะตะฝะฐ ะดะปั ะบะฐะบะพะน ะ/B-ะณััะฟะฟั, ะธ ััะฐะฝะธัั ัะฒะพะน ะปะพะบะฐะปัะฝัะน ะบะพะฝัะธะณ.ย

**ะะธะฝััั ััะพะณะพ ะฟะพะดัะพะดะฐ:**ย

- ะฒััะพะบะธะน RPS, ัะฐะบ ะบะฐะบ ะบะฐะถะดัะน ัะตัะฒะธั ะธะดัั ะทะฐ ัะบัะฟะตัะธะผะตะฝัะฐะผะธ;ย
    
- ะฟะพะปัะทะพะฒะฐัะตะปะธ ะผะพะณัั ะฝะตัะฐะฒะฝะพะผะตัะฝะพ ัะฐัะฟัะตะดะตะปััััั ะผะตะถะดั ัะบัะฟะตัะธะผะตะฝัะฐะผะธ, ัะฐะบ ะบะฐะบ ะพะดะฝะฐ ะธ ัะฐ ะถะต ะ/B-ะณััะฟะฟะฐ ะธัะฟะพะปัะทัะตััั ะดะปั ัะฐะทะฝัั ัะบัะฟะตัะธะผะตะฝัะพะฒ;ย
    
- ะฝะตั ะฒะพะทะผะพะถะฝะพััะธ ะทะฐะดะฐะฒะฐัั ััะปะพะฒะธั ะฟะพะฟะฐะดะฐะฝะธั ะฟะพะปัะทะพะฒะฐัะตะปะตะน ะฒ ัะบัะฟะตัะธะผะตะฝัั.ย
    

ะััะธัะตะบัััะฐ ััะฐะปะฐ ะฝะฐะผะฝะพะณะพ ะปัััะต, ะฟัะฐะฒะดะฐ ะฟะพัะฒะธะปะฐัั ะฟัะพะฑะปะตะผะฐ ั ะฒััะพะบะธะผ RPS: ะบะฐะบ ะณะพะฒะพัะธััั, ะทะฐ ะฒัั ะฝัะถะฝะพ ะฟะปะฐัะธัั. ย

ะะฐะฒะฐะนัะต ัะฐััะผะพััะธะผ, ะบะฐะบ ะผั ะผะพะถะตะผ ัะตัะธัั ะฒะฐะถะฝะตะนััั ะฟัะพะฑะปะตะผั ะดะปั ะฐะฝะฐะปะธัะธะบะธ โ ะฝะตัะฐะฒะฝะพะผะตัะฝะพะต ัะฐัะฟัะตะดะตะปะตะฝะธะต ะฟะพะปัะทะพะฒะฐัะตะปะตะน ะผะตะถะดั ัะบัะฟะตัะธะผะตะฝัะฐะผะธ. ย

## ะะธะฝะฐะผะธัะตัะบะธ ะพะฟัะตะดะตะปัะตะผะฐั ะ/B-ะณััะฟะฟะฐ, ะธะปะธ ะกะฒะพะน ัะตะนะบะตั ะฒ ะบะฐะถะดะพะผ ัะบัะฟะตัะธะผะตะฝัะต

ะะปั ัะพะณะพ ััะพะฑั ัะฑัะฐัั ะทะฐะฒะธัะธะผะพััั ะฟะพะฟะฐะดะฐะฝะธั ะฟะพะปัะทะพะฒะฐัะตะปั ะฒ ัะบัะฟะตัะธะผะตะฝัั ะพั ะณะปะพะฑะฐะปัะฝะพะน ะ/B-ะณััะฟะฟั, ะฒัะปะตะดััะฒะธะต ัะตะณะพ ะผะพะถะตั ะฒะพะทะฝะธะบะฐัั ะฝะตัะฐะฒะฝะพะผะตัะฝะพะต ัะฐัะฟัะตะดะตะปะตะฝะธะต ะฟะพะปัะทะพะฒะฐัะตะปะตะน ะผะตะถะดั ัะบัะฟะตัะธะผะตะฝัะฐะผะธ. ะั ะฑัะดะตะผ ะฒััะธัะปััั ะฒ ะบะฐะถะดะพะผ ัะบัะฟะตัะธะผะตะฝัะต ัะฒะพั ะ/B-ะณััะฟะฟั. ยย

ะะปั ััะพะณะพ ัะฑะธัะฐะตะผ ะฟะพัะพะด ะฒ ัะตัะฒะธั ะฐะฒัะพัะธะทะฐัะธะธ (ะปะธัะฝัั ะทะฐะฒะธัะธะผะพััั ััะพะดะธั โ ััะฐ!) โ ะธ ะฒะผะตััะพ ะ/B-ะณััะฟะฟั ะฑัะดะตะผ ะฟะตัะตะดะฐะฒะฐัั ะธะดะตะฝัะธัะธะบะฐัะพั ะฟะพะปัะทะพะฒะฐัะตะปั. ย

ะขะตะฟะตัั ะฒ ัะตัะฒะธัะตย`ab-test-api`ยะฒ ะบะฐะถะดะพะผ ัะบัะฟะตัะธะผะตะฝัะต ะผั ะผะพะถะตะผ ะพะฟัะตะดะตะปััั ะดะธะฝะฐะผะธัะตัะบะธ ะ/B-ะณััะฟะฟั ะดะปั ะฟะพะปัะทะพะฒะฐัะตะปั. ะััะธัะปััั ะตั ะบะฐะบ ัะตั-ััะฝะบัะธั ะพั ะธะดะตะฝัะธัะธะบะฐัะพัะฐ ะฟะพะปัะทะพะฒะฐัะตะปั, ะฟะพะดะผะตัะธะฒะฐัย`salt`:ย

> `ABGroup = hash(userID + salt) %100`ย

ะญัะพ ะฟะพะทะฒะพะปัะตั ัะฐะบะถะต ะดะตะปะฐัั ะฒ A/B-ัะตััะฐั ัะปะพะธ ะธ ัะฐะฒะฝะพะผะตัะฝะพ ัะฐะทะผะฐะทัะฒะฐัั ะฟะพะปัะทะพะฒะฐัะตะปะตะน ะผะตะถะดั ะฒัะตะผะธ ัะบัะฟะตัะธะผะตะฝัะฐะผะธ.ย

![](https://habrastorage.org/r/w1560/getpro/habr/upload_files/1af/e89/f1e/1afe89f1e0ca55bbfebb202419669f2a.png)

ะะฐะบะธะต ะพััะฐะปะธัั ะผะธะฝััั:ย

- ะฒััะพะบะธะน RPS, ัะฐะบ ะบะฐะบ ะบะฐะถะดัะน ัะตัะฒะธั ะธะดัั ะทะฐ ัะบัะฟะตัะธะผะตะฝัะฐะผะธ;ย
    
- ะฝะตั ะฒะพะทะผะพะถะฝะพััะธ ะทะฐะดะฐะฒะฐัั ััะปะพะฒะธั ะฟะพะฟะฐะดะฐะฝะธั ะฟะพะปัะทะพะฒะฐัะตะปะตะน ะฒ ัะบัะฟะตัะธะผะตะฝัั.ย
    

## ะะผะตััะพ ัััััะธ ฬถัฬถะปฬถะพฬถะฒฬถ ะบะฐัะบะฐะดะฝัั ะทะฐะฟัะพัะพะฒ โ gateway

ะะปั ัะพะณะพ ััะพะฑั ัะตัะธัั ะฟัะพะฑะปะตะผั ะบะฐัะบะฐะดะฝะพะณะพ ัะฒะตะปะธัะตะฝะธั RPS, ะผั ะฑัะดะตะผ ะทะฐะฟัะฐัะธะฒะฐัั ะดะฐะฝะฝัะต ะดะปั ะฒัะตั ัะตัะฒะธัะพะฒ ะฒ gateway ะธ ะฟะตัะตะดะฐะฒะฐัั ะธั ะฒะพ ะฒัะต ะฑัะบะตะฝะดั.ย

ะัั ะบัะฐัะธะฒะพ. ะัะฐะฒะดะฐ, ััั ะผั ััะฐะปะบะธะฒะฐะตะผัั ั ะฝะพะฒะพะน ะฟัะพะฑะปะตะผะพะน: ะฐ ะบะฐะบ ะธะผะตะฝะฝะพ ะฝะฐะผ ะฟะตัะตะดะฐะฒะฐัั ะธะฝัะพัะผะฐัะธั ะพะฑะพ ะฒัะตั ัะบัะฟะตัะธะผะตะฝัะฐั ะฒ ะฑัะบะตะฝะด ะฟะตัะฒะพะณะพ ะธ ะฒัะพัะพะณะพ ััะพะฒะฝะตะน? ะั ะผะพะถะตะผ ะฟะตัะตะดะฐะฒะฐัั ะตั ัะฒะฝะพ, ะฝะพ ะดะปั ััะพะณะพ ะฝัะถะฝะพ ะฑัะดะตั ะผะตะฝััั ะบะพะฝััะฐะบัั ะฒัะตั ัะตะฝะดะปะตัะพะฒ, ััะพ ะดะพะฒะพะปัะฝะพ ะฟัะพะฑะปะตะผะฐัะธัะฝะพ ะธ ะฝะตัะดะพะฑะฝะพ. ะ ะฝะฐะผ ะฝะฐ ะฟะพะผะพัั ะฟัะธัะพะดะธั ัะผะตะบะฐะปะพัะบะฐ ะธ ะธะดะตั ะดะปั ััะพะณะพ ะธัะฟะพะปัะทะพะฒะฐัั header. ะ ัะตะทัะปััะฐัะต ะผั ะพะดะธะฝ ัะฐะท ะฟะธัะตะผ ะธะฝัะพัะผะฐัะธั ะพะฑ ัะบัะฟะตัะธะผะตะฝัะฐั ะฒ header-ะทะฐะฟัะพัะฐั gateway ยโ ะธ ะดะฐะปััะต ะพะฝะฐ ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฟัะพะบัะธััะตััั ะฒะพ ะฒัะต ะทะฐะฟัะพัั ะฑัะบะตะฝะดะฐ.ย

ะะปั ัะพะณะพ ััะพะฑั ัะตะฐะปะธะทะพะฒะฐัั ัะธะปัััะฐัะธั ะฟะพะปัะทะพะฒะฐัะตะปะตะน ะฒ ัะบัะฟะตัะธะผะตะฝัะฐั, ะผั ะฟัะพััะพ ะฒ gateway ะดะตะปะฐะตะผ ะดะพะฟะพะปะฝะธัะตะปัะฝัะน ะทะฐะฟัะพั ะบ ัะตัะฒะธัั user_profile. ะะฐะฝะฝัะน ัะตัะฒะธั ะพัะฒะตัะฐะตั ะทะฐ ะธะฝัะพัะผะฐัะธั ะพ ะฟะพะปัะทะพะฒะฐัะตะปะต ะธ ะพัะดะฐะตั ะฝะฐะผ ะตั. ะะฐะปะตะต gateway ะฟะตัะตะดะฐัั ะธะฝัะพัะผะฐัะธั ะพ ะฟะพะปัะทะพะฒะฐัะตะปะต ะฒ ัะตัะฒะธัย`ab-test-api`ยะธ ะทะฐะฟัะฐัะธะฒะฐะตั ะดะฐะฝะฝัะต ะพะฑ ัะบัะฟะตัะธะผะตะฝัะฐั.ย`ab-test-api`ยะฝะฐัะพะดะธั ัะบัะฟะตัะธะผะตะฝัั, ัะดะพะฒะปะตัะฒะพััััะธะต ะดะฐะฝะฝัะผ ะฟะพะปัะทะพะฒะฐัะตะปั, ะธ ัะพะปัะบะพ ะดะปั ะฝะธั ะพัะดะฐัั ะฝะฐะฑะพั ะฒะบะปัััะฝะฝัั ัะธั.

![](https://habrastorage.org/r/w1560/getpro/habr/upload_files/4a2/e2b/834/4a2e2b834de9e2eec99ddbcd627dbc60.png)

ะะธะฝัั:ย

- ะฒัั ะตัั ะพััะฐัััั ะฒััะพะบะธะน RPS, ัะฐะบ ะบะฐะบ ะบะฐะถะดัะน ะทะฐะฟัะพั gateway ะธะดัั ะฒ ะฟะปะฐััะพัะผั A/B-ัะตััะพะฒ.ย
    

## ะะฐะบ ะผั ัะฟัะฐะฒะปัะตะผัั ั ะฒััะพะบะธะผ RPS?

ะะปั ะพัะฒะตัะฐ ะฝะฐ ััะพั ะฒะพะฟัะพั ะดะฐะฒะฐะนัะต ัะฐะทะฑะตััะผัั, ะบะฐะบ ะฟัะพะธััะพะดะธั ะดะพะฑะฐะฒะปะตะฝะธะต ัะบัะฟะตัะธะผะตะฝัะฐ ะฒ ะฟะปะฐััะพัะผั A/B-ัะตััะพะฒ.

ะัะธ ะดะพะฑะฐะฒะปะตะฝะธะธ ัะบัะฟะตัะธะผะตะฝัะฐ ะฒ ะฟะปะฐััะพัะผั A/B-ัะตััะพะฒ ัะตัะตะท ะฒะตะฑ-ะธะฝัะตััะตะนั ะทะฐะฟัะพั ะธะดัั ะฒ A/B-ะบะพะฝััะพะปะปะตั โ ัะตัะฒะธั, ะพัะฒะตัะฐััะธะน ะทะฐ ัะฟัะฐะฒะพัะฝะธะบ ะฒัะตั ัะบัะฟะตัะธะผะตะฝัะพะฒ. ะะฝ ัะพััะฐะฝัะตั ะดะฐะฝะฝัะต ะพ ะฝะพะฒะพะผ ัะบัะฟะตัะธะผะตะฝัะต ะฒ ะฑะฐะทั ะดะฐะฝะฝัั ะธ ะดะพะฑะฐะฒะปัะตั ะธั ะฒย`etcd`ย(key-value storage). ะะฐ ะธะทะผะตะฝะตะฝะธั ะฒย`etcd`ยะฟะพะดะฟะธัะฐะฝ ัะตัะฒะธัย`ab-test-api`, ะบะพัะพััะน ะพัะฒะตัะฐะตั ะทะฐ ะฑัััััะน ะพัะฒะตั ะฝะฐ ะทะฐะฟัะพัั ะฑัะบะตะฝะดะฐ. ยย

ะะพัะบะพะปัะบั ะดะฐะฝะฝัะน ัะตัะฒะธั ะฟะพะดะฟะธัะฐะฝ ะฝะฐ ะฒัะต ะธะทะผะตะฝะตะฝะธั, ะบะฐัะฐััะธะตัั ัะบัะฟะตัะธะผะตะฝัะพะฒ, ะพะฝ ัะพััะฐะฝัะตั ะธะฝัะพัะผะฐัะธั ะฒ ะปะพะบะฐะปัะฝัะน ะบัั. ะ ะปะพะบะฐะปัะฝะพะผ ะบััะต ะพะบะฐะทัะฒะฐะตััั ะธะฝัะพัะผะฐัะธั ะพะฑะพ ะฒัะตั ัะบัะฟะตัะธะผะตะฝัะฐั, ัะตะบััะธั ะธ ะฑัะดััะธั, ะฟะพ ะบะพัะพััะผ ะผะพะถะฝะพ ะฑััััะพ ะพัะดะฐัั ะธะฝัะพัะผะฐัะธั ะพ ะฟะพะฟะฐะดะฐะฝะธะธ ะฒ ะฝะธั ะฟะพะปัะทะพะฒะฐัะตะปะตะน.ย

![](https://habrastorage.org/r/w1560/getpro/habr/upload_files/aa5/2ce/6ea/aa52ce6eac46020969c99976b3a646eb.png)

ะะปะฐะณะพะดะฐัั ัะพะผั, ััะพ ั ัะตัะฒะธัะฐย`ab-test-api`ยะฒัั ะฝะฐัะพะดะธััั ะฒ ะพะฟะตัะฐัะธะฒะบะต ะธ ะพะฝ ะฟะพะดะฟะธัะฐะฝ ะฝะฐ ะฒัะต ะธะทะผะตะฝะตะฝะธั, ะบะฐัะฐััะธะตัั ัะบัะฟะตัะธะผะตะฝัะพะฒ, ะผั ะตะณะพ ะผะพะถะตะผ ะปะตะณะบะพ ะณะพัะธะทะพะฝัะฐะปัะฝะพ ะผะฐัััะฐะฑะธัะพะฒะฐัั ะธ ะฒัะดะตัะถะธะฒะฐััย**ะปัะฑะพะน RPS**.ย

**ะะธะฝััั:**ย

- ะธั ะฝะตัย๐คย
    

ะ ััะผ ะผั ะทะฐะฑัะปะธ ะฒ ะฐััะธัะตะบัััะต?ย

ะ ัะพะผ, ะฑะตะท ัะตะณะพ ะ/B-ัะตััั ะปะธัะตะฝั ัะผััะปะฐ, โ ะพะฑย**ะฐะฝะฐะปะธัะธะบะต.**ย

## ะัะฟัะฐะฒะบะฐ ะดะฐะฝะฝัั ะฒ ะฐะฝะฐะปะธัะธะบั

ะะปั ะฐะฝะฐะปะธะทะฐ ะดะฐะฝะฝัั ัะบัะฟะตัะธะผะตะฝัะฐ ะฝะตะพะฑัะพะดะธะผะพ, ััะพะฑั ะธะฝัะพัะผะฐัะธั ะพ ัะพะผ, ะฒ ะบะฐะบะธะต ัะบัะฟะตัะธะผะตะฝัั ะฟะพะฟะฐะป ะฟะพะปัะทะพะฒะฐัะตะปั, ะฑัะปะฐ ะฒ Data Lake.ย

ะั ััะพ ะพะฑะตัะฟะตัะธะปะธ ัะปะตะดัััะธะผ ะพะฑัะฐะทะพะผ. ะะพะณะดะฐ gateway ะฟะพะปััะฐะตั ะพัะฒะตั ะพั ะฑัะบะตะฝะดะฐ, ะพะฝ ะฒัั ัะพะฑัะฐะฝะฝัั ะธะฝัะพัะผะฐัะธั ะฟะตัะตะดะฐัั ะฒ ะผะพะฑะธะปัะฝะพะต ะฟัะธะปะพะถะตะฝะธะต / ััะพะฝัะตะฝะด. ะะพะฑะธะปัะฝะพะต ะฟัะธะปะพะถะตะฝะธะต / ััะพะฝัะตะฝะด ะพัะพะฑัะฐะถะฐะตั ะพัะฒะตั ะฑัะบะตะฝะดะฐ ะธ, ัะตะฐะณะธััั ะฝะฐ ะดะตะนััะฒะธั ะฟะพะปัะทะพะฒะฐัะตะปั, ะฝะฐะบะฐะฟะปะธะฒะฐะตั ะฑะฐัั ะธะฒะตะฝัะพะฒ. ะ ะฝัะถะฝัะน ะผะพะผะตะฝั ะฒัะตะผะตะฝะธ ะพะฝะธ ะพัะฟัะฐะฒะปััั ะธั ะฒ ััะตะบะตั ะฐะฝะฐะปะธัะธะบะธ. ะะฝ ะพะฑะพะณะฐัะฐะตั ะฒัะต ะธะฒะตะฝัั ะธะฝัะพัะผะฐัะธะตะน ะพะฑ ัะบัะฟะตัะธะผะตะฝัะฐั: ะดะปั ััะพะณะพ ะพะฝ ะฟะตัะตะดะฐัั ะธะฝัะพัะผะฐัะธั ะพ ะฟะพะปัะทะพะฒะฐัะตะปะต ะฒ ัะตัะฒะธัย`ab-test-api`, ะฟะพะปััะฐะตั ะพัะฒะตั ะธ ัะถะต ะพะฑะพะณะฐััะฝะฝัะต ะธะฒะตะฝัั ะพัะฟัะฐะฒะปัะตั ะฒ Data Lake.ย

ะขะตะฟะตัั ะปัะฑะพะน ะฐะฝะฐะปะธัะธะบ ะผะพะถะตั ะฟะพะนัะธ ะฒ Data Lake ะธ ะฒััะตะฟะธัั ะฒัะต ะธะฝัะตัะตััััะธะต ะตะณะพ ะธะฒะตะฝัั ะดะปั ะบะฐะถะดะพะณะพ ัะบัะฟะตัะธะผะตะฝัะฐ. Profit! ๐ย

**ะัะตะบัะฐัะฝะฐั ะฐััะธัะตะบัััะฐ, ะผั ะฒัะดะตัะถะธะฒะฐะตะผ ะปัะฑะพะน RPS.**ยะะฝะธะผะฐะฝะธะต, ะฒะพะฟัะพั:ย

![](https://habrastorage.org/r/w780q1/getpro/habr/upload_files/b48/b5d/7cc/b48b5d7cc3e583d51e06fe052141ae4e.jpg)

ะ ะดะฐะปััะต ะฑัะป...ย

![](https://habrastorage.org/r/w780q1/getpro/habr/upload_files/84c/0be/346/84c0be34637269c01d4e97f931a6df2c.jpg)

ะฃ ะฝะฐั ัะผะตั ััะตะนะดะถ, ะธ ะผั ะดะพะปะณะพ ะฝะต ะผะพะณะปะธ ะฟะพะฝััั, ััะพ ะฟัะพะธะทะพัะปะพ. ะะบะฐะทะฐะปะพัั, ััะพ ะฒัั-ัะฐะบะธ ั ะฝะฐัะตะน ะฐััะธัะตะบัััั ะฑัะปะฐ ะฟัะพะฑะปะตะผะฐ. ะ ะฟัะพะฑะปะตะผะพะน ััะพะน ะฑัะป header, ะฒ ะบะพัะพััะน ะผั ะฝะต ััะตัะฝัะปะธัั ะฟะธัะฐัั ะดะฐะฝะฝัะต ะธ ะฟะตัะตะดะฐะฒะฐะปะธ ะธะฝัะพัะผะฐัะธั ะพะฑะพ ะฒัะตั ัะบัะฟะตัะธะผะตะฝัะฐั, ะบะพัะพััะต ะฟัะพัะพะดะธะปะธ ะฒ Ozon. ะ ะบะพะณะดะฐ ะตะณะพ ัะฐะทะผะตั ะฟัะตะฒััะธะป 4 ะะฑะฐะนั, ะผั ะฟัะตะฒััะธะปะธ ะพะณัะฐะฝะธัะตะฝะธะต Nginx โ ะธ ะฝะฐ ะบะฐะถะดัะน ะทะฐะฟัะพั ะฒะพะทะฒัะฐัะฐะปะฐัั ะพัะธะฑะบะฐ.ย

![](https://habrastorage.org/r/w1560/getpro/habr/upload_files/b11/da9/1b7/b11da91b78ceacb1d7ab4f96f90d0218.png)

ะงัะพะฑั ะฟะพะฝััั, ะฒ ััะผ ะฑัะปะฐ ะฟัะพะฑะปะตะผะฐ, ัะฐััะผะพััะธะผ ะดะฒะฐ ัะตัะฒะธัะฐ, ะฒ ะบะพัะพััั ะฟัะพัะพะดัั ัะบัะฟะตัะธะผะตะฝัั:ย

- **ัะตัะฒะธั ะฟะพะธัะบะฐ**ยc ะฟะฐัะฐะผะตััะพะผย`rankingAlgorithm string`,ย
    
- **ัะตัะฒะธั ะบะพัะทะธะฝั**ยั ะฟะฐัะฐะผะตััะพะผย`IsNewCart string`.ย
    

ะัะปะธ ะดะปั ััะธั ัะตัะฒะธัะพะฒ ะฟัะตะดััะฐะฒะธัั JSON, ะบะพัะพััะน ะผั ะฟะตัะตะดะฐะฒะฐะปะธ ะฒ header, ัะพ ะพะฝ ะฑัะดะตั ะฟัะธะผะตัะฝะพ ัะปะตะดัััะตะณะพ ะฒะธะดะฐ:ย

```
{         "search": {                 "config": {                         "rankingAlgo": "newAlgo"                 },                 "experiments": [{"ID":1,"variantID":2}]         },         "cart": {                 "config": {                         "isNewCart": true                 },                 "experiments": [{"ID":2,"variantID":4}] } 
```

ะ ะตัะปะธ ัะบัะฟะตัะธะผะตะฝัะพะฒ ััะฐะฝะพะฒะธััั ะผะฝะพะณะพ, ัะพ ััะพั JSON ะผะพะถะตั ะฝะฐะฑะธัะฐัั ะบะธะปะพะฑะฐะนัะฝัะต ัะฐะทะผะตัั. ย

ะะปั ัะผะตะฝััะตะฝะธั ะณะธะณะฐะฝััะบะพะณะพ ัะฐะทะผะตัะฐ JSON ะผั ะฟัะธะดัะผะฐะปะธ ัะปะตะดัััะธะน FastFix.ย

## FastFix

ะะดะตั: ะฒะผะตััะพ ััะพะณะพ ะฟัะตะบัะฐัะฝะพะณะพ JSON ะฒ header ะฑัะดะตะผ ะฟะตัะตะดะฐะฒะฐัั ะบะพะผะฟะฐะบัะฝัะน UUID. ย

![](https://habrastorage.org/r/w1560/getpro/habr/upload_files/7e0/6da/101/7e06da101ff39e1c1e92cf98e75072ab.png)

ะะปั ััะพะณะพ ab-test-api ะฟัะธ ะฟะพะปััะตะฝะธะธ ะทะฐะฟัะพัะฐ ะพั gateway ะฒััะธัะปัะตั JSON, ะณะตะฝะตัะธัย**UUID**ยะธ ะดะฐะปะตะต ััะพั JSON ะฟะพ ะบะปััั UUID ัะพััะฐะฝัะตั ะฒ Memcached. ะขะตะฟะตัั ะฟะพ ััะพะผั ะบะปััั ะฑัะบะตะฝะด ะผะพะถะตั ะฟะพะปััะธัั ะดะฐะฝะฝัะต. ย

ะะพััะพะผั ัะตัะฒะธัย`ab-test-api`ยะฒะผะตััะต ั ะบะพะฝัะธะณะพะผ ะฑัะบะตะฝะดะฐ ะฒะพะทะฒัะฐัะฐะตั UUID ะฒ gateway ะธ ะดะฐะปะตะต gateway ะฟะตัะตะดะฐัั ะฒ header UUID ะฒัะตะผ ัะตัะฒะธัะฐะผ ะฑัะบะตะฝะดะฐ. ะะพะณะดะฐ ะฑัะบะตะฝะด-ัะตัะฒะธัั ะฝะตะพะฑัะพะดะธะผะพ ัะทะฝะฐัั, ะบะฐะบะธะต ัะธัะธ ะฒะบะปััะตะฝั ะดะปั ะฟะพะปัะทะพะฒะฐัะตะปั, ะพะฝ ะธะดัั ะฒย`ab-test-api`, ะฟะตัะตะดะฐะฒะฐั ััะดะฐ UUID.ย`ab-test-api`ยะฒ ัะฒะพั ะพัะตัะตะดั ะธะดัั ะฟะพ ััะพะผั ะบะปััั ะฒ Memcached, ะฟะพะปััะฐะตั JSON ะธ ะธะท ะฝะตะณะพ ะพัะดะฐัั ะฝะฐะฑะพั ะฒะบะปัััะฝะฝัั ัะธัะตะน ะดะปั ัะตัะฒะธัะฐ.ย

ะขะฐะบะถะต ะดะปั ัะตัะฒะธัะพะฒ ะฟะตัะฒะพะณะพ ััะพะฒะฝั ะผะพะถะฝะพ ะฟะตัะตะดะฐะฒะฐัั ะธะท gateway ัะฒะฝัะผ ะพะฑัะฐะทะพะผ ะฝะฐะฑะพั ะฒะบะปัััะฝะฝัั ัะธั ะฒ body, ััะพะฑั ัะฑัะฐัั ะปะธัะฝะตะต ะพะฑัะฐัะตะฝะธะต ะบย`ab-test-api`.ย

![](https://habrastorage.org/r/w1560/getpro/habr/upload_files/51b/4d9/c65/51b4d9c6523abe9f666dd49ac021ccc8.png)

ะขะฐะบ ะผั ัะตัะธะปะธ ะฟัะพะฑะปะตะผั ะฑะพะปััะพะณะพ header โ ัะตะฟะตัั ะตะณะพ ัะฐะทะผะตั ะฒัะตะณะดะฐ ัะธะบัะธัะพะฒะฐะฝ. ย

ะะฐะถะตััั, ะผะพะถะฝะพ ะฑัะปะพ ะฝะฐ ััะพะผ ะพััะฐะฝะพะฒะธัััั, ะฝะพ ั ะดะฐะฝะฝะพะณะพ ะฟะพะดัะพะดะฐ ะตััั ะผะธะฝััั:ย

- ะดะพะฟะพะปะฝะธัะตะปัะฝัะน RPS ัะตัะฒะธัะพะฒ ะฒัะพัะพะณะพ ััะพะฒะฝั;ย
    
- ะดะพะฟะพะปะฝะธัะตะปัะฝะฐั ะทะฐะฒะธัะธะผะพััั ะฐััะธัะตะบัััั ะพั Memcached,ยะบะพัะพััะน ะฝะฐ ัััะตัั-ัะตััะฐั ะฝัะถะฝะพ ะผะฐัััะฐะฑะธัะพะฒะฐัั.ย
    

ะะพัะบะพะปัะบั ะผั ัะฟะพัะพััะต ะธะฝะถะตะฝะตัั ะธ ะฑะพัะตะผัั ะทะฐ ะผะธะปะปะธัะตะบัะฝะดั, ัะพ ะฟัะธะดัะผะฐะปะธ, ะบะฐะบ ะธะทะฑะฐะฒะธัััั ะพั ััะธั ะดะฒัั ะผะธะฝััะพะฒ ะธ ัะดะตะปะฐััย**ะธะดะตะฐะปัะฝัั ะฐััะธัะตะบัััั**ย๐ยย

## ะะดะตะฐะปัะฝะฐั ะฐััะธัะตะบัััะฐ

ะะฐะบ ัะบะฐะทะฐะป ะะฐะบ ะะตัะต,ย

![](https://habrastorage.org/r/w1560/getpro/habr/upload_files/1ae/7e6/151/1ae7e6151ad542bf6d4180b434719d64.png)

### ะะพััะพะผั ะฟะปะฐะฝ ัะฐะบะพะน:ย

- ััะพะฑั ะธะทะฑะฐะฒะธัััั ะพั Memcached, ะฝัะถะฝะพ ะฟะตัะตะดะฐะฒะฐัั ะดะฐะฝะฝัะต ะพะฑ ัะบัะฟะตัะธะผะตะฝัะฐั ะฒ header, ะบะฐะบ ะฒ ััะฐััะต ะดะพะฑััะต ะฒัะตะผะตะฝะฐ;ย
    
- ััะพะฑั ัะตัะธัั ะฟัะพะฑะปะตะผั RPS ัะตัะฒะธัะพะฒ ะฒัะพัะพะณะพ ััะพะฒะฝั, ะฝัะถะฝะพ ัะดะตะปะฐัั ะฝะฐ ะบะปะธะตะฝัะต ะบัั;ย
    
- ััะพะฑั ะฝะต ะฝะฐัััะฟะธะป ะัะผะฐะณะตะดะดะพะฝ ั ัะฐะทะผะตัะพะผ header, ะฝัะถะฝะพ ะฟัะธะดัะผะฐัั ะผะธะฝะธะผะฐะปัะฝัะน ัะพัะผะฐั ัะถะฐัะธั ะดะฐะฝะฝัั ะพะฑ ัะบัะฟะตัะธะผะตะฝัะฐั.ย
    

ะะฝััััะผะตะฝั, ะบะพัะพััะน ัะตัะฐะตั ะฒัั ััะธ ะฟัะพะฑะปะตะผั โย**ะฑะธะฝะฐัะฝัะน ะฟัะพัะพะบะพะป**ยะฟะตัะตะดะฐัะธ ะธะฝัะพัะผะฐัะธะธ ะพะฑ ัะบัะฟะตัะธะผะตะฝัะฐั, ะฒ ะบะพัะพััะต ะฟะพะฟะฐะป ะฟะพะปัะทะพะฒะฐัะตะปั. ย

![](https://habrastorage.org/r/w1560/getpro/habr/upload_files/80b/2ee/987/80b2ee98713cd8e25af141e118c923c9.png)

ะฆะตะปั ะฑะธะฝะฐัะฝะพะณะพ ะฟัะพัะพะบะพะปะฐ โ ะฒ ะบะฐะบ ะผะพะถะฝะพ ะฑะพะปะตะต ัะถะฐัะพะผ ะฒะธะดะต ะฟัะตะดััะฐะฒะธัั ะธะฝัะพัะผะฐัะธั ะพะฑ ัะบัะฟะตัะธะผะตะฝัะฐั, ะฒ ะบะพัะพััะต ะฟะพะฟะฐะป ะฟะพะปัะทะพะฒะฐัะตะปั. ย

ะะตะฐะปะธะทะฐัะธั ะดะฐะฝะฝะพะณะพ ะฟัะพัะพะบะพะปะฐ ะดะฐัั ะฒะพะทะผะพะถะฝะพััั ะธัะฟะพะปัะทะพะฒะฐัั ะตะณะพ ะบะฐะบ ัะฝะธะบะฐะปัะฝัะน ะธะดะตะฝัะธัะธะบะฐัะพั ะฒะบะปัััะฝะฝัั ะดะปั ะฟะพะปัะทะพะฒะฐัะตะปั ัะบัะฟะตัะธะผะตะฝัะพะฒ, ัะพ ะตััั ะฒ ะบะฐัะตััะฒะต ะบะปััะฐ ะบััะฐ ะดะปั ะบะปะธะตะฝัะพะฒ ะฑัะบะตะฝะดะฐ. ะญัะพ ะฟะพะทะฒะพะปัะตั ะฝะฐะผ ัะตะฐะปะธะทะพะฒะฐัั ะบัั ะดะปั ะบะปะธะตะฝัะพะฒ ะฑัะบะตะฝะดะฐ ะฒัะพัะพะณะพ ััะพะฒะฝั, ััะพะฑั ะทะฝะฐัะธัะตะปัะฝะพ ัะผะตะฝััะธัั RPS.ย

ะั ะฟัะธะดัะผะฐะปะธ ัะปะตะดัััะธะน ัะพัะผะฐั ะฑะธะฝะฐัะฝะพะณะพ ะฟัะพัะพะบะพะปะฐ:ย

- ะฟะตัะฒัะต 10 ะฑะธั ะธัะฟะพะปัะทััััั ะดะปั ะฟะตัะตะดะฐัะธ ะธะดะตะฝัะธัะธะบะฐัะพัะฐ ัะตัะฒะธัะฐ (ะผั ะพััะฐะปะบะธะฒะฐะตะผัั ะพั ัะพะณะพ, ััะพ ะผะฐะบัะธะผะฐะปัะฝะพะต ะบะพะปะธัะตััะฒะพ ัะตัะฒะธัะพะฒ โ 2^10);ย
    
- 4 ะฑะธัะฐ ะฝะพะผะตั ัะตะฒะธะทะธะธ, ะบะพะณะดะฐ ะดะพะฑะฐะฒะปััััั ะฝะพะฒัะต ัะบัะฟะตัะธะผะตะฝัั/ัะดะฐะปััััั ะผะตะฝัะตััั ะฝะพะผะตั ัะตะฒะธะทะธะธ. ะขะฐะบะธะผ ะพะฑัะฐะทะพะผ ะผั ัะตัะธะปะธ ะพะดะฝั ะธะท ะณะปะฐะฒะฝัั ะฟัะพะฑะปะตะผ ะฒ IT โ ะฟัะพะฑะปะตะผั ะธะฝะฒะฐะปะธะดะฐัะธะธ ะบััะฐ;ย
    
- n ะฑะธั ะดะปั ะฟะตัะตะดะฐัะธ ะฑะธัะพะฒะพะน ะผะฐัะบะธ ะฒะฐัะธะฐะฝัะพะฒ ัะบัะฟะตัะธะผะตะฝัะพะฒ, ะฒ ะบะพัะพััะต ะฟะพะฟะฐะป ะฟะพะปัะทะพะฒะฐัะตะปั.ย
    

![](https://habrastorage.org/r/w1560/getpro/habr/upload_files/1e6/f72/cc6/1e6f72cc671fa5480e88d763de644ba9.png)

ะขะฐะบะธะผ ะพะฑัะฐะทะพะผ, JSON ะธะท ะฝะฐัะตะณะพ ะฟัะธะผะตัะฐ ะบะพะฝะฒะตััะธััะตััั ะฒ ััะพั ะบัะฐัะธะฒัะน ัะพัะผะฐั:ย

![](https://habrastorage.org/r/w1560/getpro/habr/upload_files/991/109/cee/991109cee92917b3d63c066eeabf2e2f.png)

ะะพะปััะฐะตััั ะฟัะตะบัะฐัะฝะฐั ะฐััะธัะตะบัััะฐ, ะฒ ะบะพัะพัะพะนย`ab-test-api`ยะฟัะธ ะฟะพะปััะตะฝะธะธ ะทะฐะฟัะพัะฐ ะพั gateway ะฒััะธัะปัะตั ะดะปั ะบะฐะถะดะพะณะพ ะฟะพะปัะทะพะฒะฐัะตะปั ะทะฝะฐัะตะฝะธะต ะฝะฐัะตะณะพ ะฑะธะฝะฐัะฝะพะณะพ ะบะปััะฐ (binary key) ะบะฐะบ ะฝะฐะฑะพั ัะฝะธะบะฐะปัะฝัั ัะบัะฟะตัะธะผะตะฝัะพะฒ, ะฒ ะบะพัะพััะต ะฟะพะฟะฐะป ะฟะพะปัะทะพะฒะฐัะตะปั. ะขะตะฟะตัั ะฟะพ ััะพะผั ะบะปััั ะฑัะบะตะฝะด ะผะพะถะตั ะฒะทััั ะดะฐะฝะฝัะต ะธะท ะบััะฐ ะธะปะธ ะทะฐะฟัะพัะธัั ะธั ะดะปั ะฟัะพะณัะตะฒะฐ. ย

ะะพััะพะผั ะผั ะฟัะพะบัะธััะตะผ binary key ะฒะผะตััะพ UUID ะธะท gateway ะฒะพ ะฒัะต ัะตัะฒะธัั ะฑัะบะตะฝะดะฐ ะฒ header. ะะพะณะดะฐ ะฑัะบะตะฝะด-ัะตัะฒะธัั ะฝะตะพะฑัะพะดะธะผะพ ัะทะฝะฐัั, ะบะฐะบะธะต ัะธัะธ ะฒะบะปััะตะฝั ะดะปั ะฟะพะปัะทะพะฒะฐัะตะปั, ะพะฝ ัะผะพััะธั, ะตััั ะปะธ ะดะฐะฝะฝัะต ะฟะพ ะฑะธะฝะฐัะฝะพะผั ะบะปััั ะฒ ะบััะต? ะัะปะธ ะตััั, ััะฐะทั ะฑะตััั ะธั, ะตัะปะธ ะฝะตั โ ะธะดัั ะฒย`ab-test-api`ยั binary key, ะฟะพะปััะฐะตั ะฝะฐะฑะพั ะฒะบะปัััะฝะฝัั ะดะปั ะฟะพะปัะทะพะฒะฐัะตะปั ัะธั ะธ ัะพััะฐะฝัะตั ะธั ะฒ ะบัั. ะขะฐะบะธะผ ะพะฑัะฐะทะพะผ, ะตัะปะธ ั ัะฐะบะธะผ ะถะต ะฑะธะฝะฐัะฝัะผ ะบะปััะพะผ ะฟัะธะดัั ะตัั ะพะดะธะฝ ะทะฐะฟัะพั, ัะตะทัะปััะฐั ะฒะพะทัะผัะผ ะธะท ะบััะฐ.ย

ะขะฐะบะถะต ะดะปั ัะตัะฒะธัะพะฒ ะฟะตัะฒะพะณะพ ััะพะฒะฝั ะผั ะฟะตัะตะดะฐัะผ ะธะท gateway ัะฒะฝัะผ ะพะฑัะฐะทะพะผ ะฝะฐะฑะพั ะฒะบะปัััะฝะฝัั ัะธั ะฒ body ะดะปั ะบะฐะถะดะพะณะพ ัะตัะฒะธัะฐ.

![](https://habrastorage.org/r/w1560/getpro/habr/upload_files/114/68b/32b/11468b32b7e82fc3a7c0683a8fcec9f6.png)

ะ ัะตะทัะปััะฐัะต ะผั ัะฑัะฐะปะธ ะปะธัะฝัั ะทะฐะฒะธัะธะผะพััั ะพั Memcached โ ะธ ะผะพะถะตัะต ัะฒะธะดะตัั ะฝะฐ ัะบะพะปัะบะพ ัะฟะฐะป RPS ะดะปั ัะตัะฒะธัะพะฒ ะฒัะพัะพะณะพ ััะพะฒะฝั: ะฝะฐ ะฟัะธะผะตัะต ัะตัะฒะธัะฐย`rtb-api`, ะฒ ะบะพัะพัะพะผ ั ะฝะฐั ะฑัะปะพ ัะผะตะฝััะตะฝะธะต RPSย**ะฒ 500 ัะฐะท**ย(ั 5k ะดะพ 9.87).

![](https://habrastorage.org/r/w1560/getpro/habr/upload_files/f58/eb4/74e/f58eb474ed65b12cfce691f0628117e1.png)

![](https://habrastorage.org/r/w1560/getpro/habr/upload_files/d4f/de6/cda/d4fde6cdaaf7483169d09de2f7de0797.png)

## ะ/B ะฝะฐ ะพัััะธะต ะฐัะฐะบะธ RPS

ะะปะฐะณะพะดะฐัั ะฟัะพััะพัะต, ะผะฐัััะฐะฑะธััะตะผะพััะธ ะธ ะบัะฐัะพัะต ะฟะปะฐััะพัะผั ะ/B-ัะตััะพะฒ ะฝะฐัะฐ ะบะพะผะฐะฝะดะฐ ัะฐััะพ ะฝะฐัะพะดะธะปะฐยะฟัะพะฑะปะตะผั ะธะฝััะฐััััะบัััั ะธ ััะพัะปะฐ ั ะธััะพะบะพะฒ ะฑะพะปััะธั ะพัะบัััะธะน Ozon.ย

ะะฐ ะฒัะตะผั ะผะพะตะน ัะฐะฑะพัั ะฒ ะบะพะผะฟะฐะฝะธะธ ะฑัะปะธ ะทะฐะฟััะตะฝั ัะตะฒะพะปััะธะพะฝะฝัะต ัะธัะธ, ะบะพัะพััะต ะพะบะฐะทะฐะปะธ ะฑะพะปััะพะต ะฒะปะธัะฝะธะต ะฝะฐ ะพะฟัะธะผะธะทะฐัะธั ัะบะพัะพััะธ ะพัะฒะตัะฐ ะฒัะตะณะพ ะฑัะบะตะฝะดะฐ. ะ ะฑะตะท ััะตัะฝะตะฝะธั ะผะพะณั ัะบะฐะทะฐัั, ััะพ ัะฐััะพ ะฒัั ะฝะฐัะธะฝะฐะปะพัั ั ะฝะฐัะตะน ะฟะปะฐััะพัะผั ะ/B-ัะตััะพะฒ.ย

> **~~ะ ะฝะฐัะฐะปะต ะฑัะปะพ ัะปะพะฒะพ~~**
> 
> ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย **ะ ะฝะฐัะฐะปะต ะฑัะป ะ/B-ัะตัั**

### ะัะพะฑะปะตะผะฐ ะบะปะธะตะฝััะบะพะน ะฑะฐะปะฐะฝัะธัะพะฒะบะธ

ะะฒะพะดะฝะฐั ะธะฝัะพัะผะฐัะธั:ย

- ะฒัะตะผั ะพัะฒะตัะฐ ab-test-api ะฟะพ 99 ะบะฒะฐะฝัะธะปะธ <ย**1 ะผั**;ย
    
- ะพะดะฝะฐะบะพ ะผั ะพัะฒะฐะปะธะฒะฐะปะธัั ะฟะพ ัะฐะนะผ-ะฐััั ะพั gateway, ะบะพัะพััะน ััะป ัะพ ะฒัะตะผะตะฝะตะผ ะพะถะธะดะฐะฝะธัย**10 ะผั.**ยะขะฐะบะธั ะทะฐะฟัะพัะพะฒ ะฑัะปะพย
    

![](https://habrastorage.org/r/w1560/getpro/habr/upload_files/ce4/c08/bb5/ce4c08bb5eb1871ee8bf8d3aaf8e1151.png)

4% ะพัะธะฑะพะบ ะ/B-ัะตััะพะฒ, ะฟััะณะฐััะธั ัะธั ะธ ะฟัะพะฑะปะตะผ ะฒ ะฐะฝะฐะปะธัะธะบะต โ ััะพ ะฑะตะดะฐ.ย

ะะพะณะดะฐ ัั ะฟัะธัะพะดะธัั ะบ ะบะพะผะฐะฝะดะต ะธะฝััะฐััััะบัััั ะธ ะณะพะฒะพัะธัั, ััะพ ะฒัะพะดะต ะฟัะพะฑะปะตะผะฐ ะฒ ะธะฝััะฐััััะบัััะต, ัะตะฑะต ะฒัะตะณะดะฐ ัะฒะตัะตะฝะฝะพ ะพัะฒะตัะฐัั: ย

> ยซะะฐั ะบะพะด โย~~๐ฉ~~ยะฝะต ะพัะตะฝั, ะพะฟัะธะผะธะทะธััะนัะตยป.ย

ะัะปะธ ัั ะพัะฒะตัะฐะตัั, ััะพ ะฐััะธัะตะบัััะพัะบะฐ โ ะพะณะพะฝั, ัะตะฑะต ะพัะฒะตัะฐัั: ยซะกะผ. ะฟ. 1ยป.ย

ะัะธัะปะพัั ะทะฐัััะธัั ััะบะฐะฒะฐ ะธ ะดะพะบะฐะทัะฒะฐัั, ััะพ ะฟัะพะฑะปะตะผะฐ ะฝะต ะฝะฐ ะฝะฐัะตะน ััะพัะพะฝะต. ะะปั ััะพะณะพ ะฑัะปะพ ัะตัะตะฝะพ ัะดะตะปะฐัั ะดะฒะฐ ัะตัะฒะธัะฐ:ย

- `ab-poligon`ยc ะผะตัะพะดะพะผย`Ping`, ะบะพัะพััะน ะฝะต ะดะตะปะฐะตั ัะพะฒะฝัะผ ััััะพะผ ะฝะธัะตะณะพ, ะบัะพะผะต ัะพะณะพ ััะพ ััะฐะทั ะฒะพะทะฒัะฐัะฐะตั ะพัะฒะตั, ััะพะฑั ะฝะตะฒะพะทะผะพะถะฝะพ ะฑัะปะพ ะฟัะธะดัะฐัััั ะบ ะฝะตะพะฟัะธะผะฐะปัะฝะพะผั ะบะพะดั;ย
    
- `ab-shooter`, ััะพะฑั ัััะตะปััั ะฟะพ ะฝะฐัะตะผั ัะตัะฒะธัั ะฟะพะปะธะณะพะฝะฐ ั ะฝัะถะฝัะผ RPS ะธ ะธะทะผะตัััั ะฝัะถะฝัะผ ะพะฑัะฐะทะพะผ ัะบะพัะพััั ะพัะฒะตัะฐ (ะทะฐะดะฐะฝะฝัะผะธ ะฑะฐะบะตัะฐะผะธ ะฒ Prometheus). ย
    

ะะฐะปะตะต ะผั ะดะตะปะฐะปะธ ััะด ัััะตะปัะฑ ะธะท shooter ะธ ะทะฐะผะตัะธะปะธ, ััะพ ัะตัะฒะธั, ะบะพัะพััะน ะฝะต ะดะตะปะฐะตั ัะพะฒะฝัะผ ััััะพะผ ะฝะธัะตะณะพ ะฟัะธ 1k RPS, ะพัะฒะตัะฐะตั ะฒ 4% ะทะฐะฟัะพัะฐั ะดะพะปััะต 10 ะผั ะฟัะธ ะปัะฑะพะผ ะบะพะปะธัะตััะฒะต ะฟะพะดะพะฒ, ัะฐะบ ะถะต, ะบะฐะบ ะธ ะผั.

Proof! ๐ ะขะพ ะตััั ะผั ะดะพะบะฐะทะฐะปะธ, ััะพย**ะฝะธ ะพะดะธะฝ ัะตัะฒะธั**ยะฝะต ะผะพะถะตั ะพัะฒะตัะฐัั ะฑััััะตะตย**10 ะผั**ยะฟะพ 96 ะบะฒะฐะฝัะธะปะธ, ะดะฐะถะต ะฝะต ะฟะพ 99.ย

![](https://habrastorage.org/r/w1560/getpro/habr/upload_files/d2b/d2e/a24/d2bd2ea246ba5552210d34cf5c195745.png)

ะะฐะปะตะต ะฟะพัะปะต ะพะฑัะตะฝะธั ั ะบะพะผะฐะฝะดะพะน ะธะฝััะฐััััะบัััั ะผั ัะตัะธะปะธ ะฟะพะฟัะพะฑะพะฒะฐัั ะดะตะปะฐัั ะทะฐะฟัะพัยะฒ ะฝะฐั ะฒ ะฑัะบะตะฝะดยะผะธะฝัั Ingress Controller:ย

![](https://habrastorage.org/r/w1560/getpro/habr/upload_files/946/9ce/403/9469ce4036aca6af942d44630a216bd5.png)

ะั ััะฐะปะธ ะดะตะปะฐัั ะทะฐะฟัะพััยะฟะพ IP ะธะท shooter ะฒ ะฟะพะปะธะณะพะฝ ะธ ััะพ ะฟัะธะฒะตะปะพ ะฝะฐั ะบ ัะปะตะดัััะตะผั ัะตะทัะปััะฐัั:ย**ะฒะผะตััะพ 4% ะทะฐะฟัะพัะพะฒ**, ะบะพัะพััะต ะพัะฒะตัะฐะปะธ ะดะพะปััะต 10 ะผั,ย**ะธั ััะฐะปะพ ะผะตะฝััะต 1%**. ะะพ 0,9 ะบะฒะฐะฝัะธะปะธ ะฒัะตะผั ะพัะฒะตัะฐ Ping ั 5 ะผั ัะผะตะฝััะธะปะพัั ะดะพ 1 ะผั, ัะพ ะตัััย**ะฒ ะฟััั ัะฐะท**, ะฐ ะฟะพ 0,99 โ ะฒย**ัะตะผั ัะฐะท**.ยย

ะ ัะตะทัะปััะฐัะตย**ะฟัะพัะตะฝั ะพัะธะฑะพะบ**ยgateway ะฟะพ ัะฐะนะผ-ะฐััั ัะผะตะฝััะธะปัั ั 4% ะดะพ 0,2% โยัะพ ะตััั ะฒย**20 ัะฐะท**.ย

ะญัะพ ะฟัะธะฒะตะปะพ ะบ ัะธััะตะผะฝะพะผั ัะตัะตะฝะธั ะฒะฝัััะธ ะบะพะผะฟะฐะฝะธะธ: ัะฑัะฐัั ะฑะฐะปะฐะฝัะธัะพะฒะบั ะฝะฐ ััะพะฒะฝะต Ingress Controller ะธ ะฟะตัะตะฝะตััะธ ะตั ะฝะฐ ะบะปะธะตะฝััะบัั ััะพัะพะฝั. ะญัะพ ะฒ ัะฐะทั ัะผะตะฝััะธะปะพ ะฒัะตะผั ะฝะฐ Round Trip ะดะปั ะพัะฒะตัะพะฒ ะฑัะบะตะฝะดะฐย**ะฒัะตะณะพ Ozon**.ย

ะะฐะปะตะต ะผั ะถะธะปะธ-ะฝะต ััะถะธะปะธ ัะพะฒะฝะพ ะณะพะด, ะบะฐะบ ะบ ะฝะฐะผ ะฒ ะดะฒะตัั ัะฝะพะฒะฐ ะฟะพััััะฐะปะพัั ะดะพะปะณะพะต ะฒัะตะผั ะพัะฒะตัะฐ ะธ ะผั ััะพะปะบะฝัะปะธัั ัะพ ัะปะตะดัััะตะน ัะธััะฐัะธะตะน.ย

## ะัะพะฑะปะตะผะฐ ัะดะตั ัะตัะตะฒัั ะบะฐัั

ะั ะทะฐะผะตัะธะปะธ, ััะพ ะฝะฐั ัะตัะฒะธั ะพัะฒะตัะฐะตั ะดะพะปััะต 40 ะผั ะฟะพ 99 ะบะฒะฐะฝัะธะปะธ, ััะพ ะฝะตะฒะพะทะผะพะถะฝะพ, ััะธััะฒะฐั ะฝะฐัั ะฐััะธัะตะบัััั. ะัั ะฝะฐัะพะดะธััั ะฒ ะพะฟะตัะฐัะธะฒะบะต, ะธ ะฟัะธ ัะพัะพัะตะผ ะผะฐัััะฐะฑะธัะพะฒะฐะฝะธะธ ะฟะพะดะพะฒ ัะตัะฒะธั ะฟัะพััะพ ะฟะพ ะพะฟัะตะดะตะปะตะฝะธั ะฝะต ะผะพะถะตั ะพัะฒะตัะฐัั ะดะพะปะณะพ. ย

ะั ะฟัะธัะปะธ ะบ ะบะพะผะฐะฝะดะต ะธะฝััะฐััััะบัััั, ะธััะพัะธั ะฟะพะฒัะพัะธะปะฐัั:ย

> ยซะะฐั ะบะพะด โย~~๐ฉ~~ยะฝะต ะพัะตะฝั, ะพะฟัะธะผะธะทะธััะนัะต. ะัะปะธ ััะพ-ัะพ ะฝะตะฟะพะฝััะฝะพ, ัะผ. ะฟ. 1ยป.ย

ะะฐะผ ะฟัะธัะปะพัั ัะฐััะตัะปะธัั ะฝะฐัะธ shooterยั ะฟะพะปะธะณะพะฝะพะผ, ะบะพัะพััะต ะฟะพะบะฐะทะฐะปะธ, ััะพ Round Trip ะฑะพะปััะตย**40 ะผั**ยะฒย**1,266%**ยะพัะฒะตัะพะฒ ะดะปั ัะตัะฒะธัะฐ, ะบะพัะพััะน ัะพะฒะฝัะผ ััััะพะผ ะฝะธัะตะณะพ ะฝะต ะดะตะปะฐะตั. ะญัะพ ะณะพะฒะพัะธั ะพ ัะพะผ, ััะพ ะฟะพย**99 ะบะฒะฐะฝัะธะปะธ**ยัะบะพัะพััั ะพัะฒะตัะฐย**ะปัะฑะพะณะพยะฑัะบะตะฝะดะฐ**ยะฟะพ ะฐะฟัะธะพัะธ ะฝะต ะผะพะถะตั ะฑัััย**ะผะตะฝััะต 40 ะผั**ยะธ ะฑะตะทััะปะพะฒะฝะพ ััะพ ะฐััะตะบัะธัย**ะฒะตัั Ozon.**

![](https://habrastorage.org/r/w1560/getpro/habr/upload_files/dca/8fe/dea/dca8fedea1ad98791ba442152267ab3f.png)

ะะฐะปะตะต ะผั ะทะฐะฑะธะปะธ ะฒ ะบะพะปะพะบะพะป, ัะพะฑัะฐะปะธ ะดะพะบะฐะทะฐัะตะปัะฝัั ะฑะฐะทั, ะฟะตัะตะดะฐะปะธ ะฒัะต ะผะฐัะตัะธะฐะปั ัะตะฑััะฐะผ ะธะท ะบะพะผะฐะฝะดั ะฟะปะฐััะพัะผั, ะพะฝะธ ะฒะทัะปะธ ะฝะฐ ะฒะพะพััะถะตะฝะธะต ะฝะฐั ัััะตั ั ะฟะพะปะธะณะพะฝะพะผ, ัะฐััะปะตะดะพะฒะฐะปะธ ะฟัะพะฑะปะตะผั ะธ ัะตัะธะปะธ ะตั. ะญัะพ ัะธะปัะฝะพ ะพะฟัะธะผะธะทะธัะพะฒะฐะปะพ ัะบะพัะพััั ะฒัะตะณะพ Ozon. ะ ัะตะฑััะฐ ะฝะฐะฟะธัะฐะปะธย[ะฟัะตะบัะฐัะฝัั ััะฐััั](https://habr.com/ru/company/ozontech/blog/662758/)ย(ัะตะบะพะผะตะฝะดัั ะบ ะฟัะพััะตะฝะธั), ะฒ ะบะพัะพัะพะน ะตััั ะฟะฐััะฐะปะพัะบะฐ ะพ ะฝะฐัะตะน ะฟะปะฐััะพัะผะต ะ/B-ัะตััะพะฒ:ย

![](https://habrastorage.org/r/w1560/getpro/habr/upload_files/6c1/8e3/5a2/6c18e35a2b3cc970492ed4fdc5439bf5.png)

## ะะฐะบะปััะตะฝะธะต

![](https://habrastorage.org/r/w1560/getpro/habr/upload_files/5c9/a84/548/5c9a84548ac0f144c401e2501bbc0352.png)

ะะฝะต ะทะฐะฒะธัะธะผะพััะธ ะพั ัะพะณะพ, ะบะฐะบัั ะธะผะตะฝะฝะพ ัะธััะตะผั ะฒั ัััะพะธัะต:ย  
  
โข ะพัะฝะพะฒัะฒะฐััั ะฝะฐ ะพะฟััะต ะฝะฐัะตะณะพ ะัะผะฐะณะตะดะดะพะฝะฐ, ัะตะบะพะผะตะฝะดัั ะทะฐัะฐะฝะตะต ััะตััั ะฒัะต ะฝัะฐะฝัั ะตั ะฟัะพะฟััะบะฝะพะน ัะฟะพัะพะฑะฝะพััะธ ะธ ะธะผะตัั ะฟะตัะตะด ะณะปะฐะทะฐะผะธ ะผะตััะธะบั, ะบะพัะพัะฐั ะณะพะฒะพัะธั ะพ ัะพะผ, ัะบะพะปัะบะพ ะฒัะตะผะตะฝะธ/ัะตััััะพะฒ ะพััะฐะปะพัั ะดะพ ะพะณะฝั ะฝะฐ ะฟัะพะดะฐะบัะตะฝะต;ย  
  
โข ะพัะฝะพะฒัะฒะฐััั ะฝะฐ ะฟัะพะดะตะผะพะฝัััะธัะพะฒะฐะฝะฝััย**ะฒะพััะผะธ**ยะฒะพะทะผะพะถะฝัั ะฟะพะดัะพะดะฐั (ะผะพะดะธัะธัะธะบะฐัะธัั) ะฟะปะฐััะพัะผั ะ/B-ัะตััะพะฒ, ัะตะบะพะผะตะฝะดัั ะธะทะพ ะฒัะตั ัะธะป ะฑะพัะพัััั ะทะฐ ะผะฐะบัะธะผะฐะปัะฝะพ ะฟัะพัััั ะฐััะธัะตะบัััั ั ะผะธะฝะธะผะฐะปัะฝัะผ ะบะพะปะธัะตััะฒะพะผ ะทะฐะฒะธัะธะผะพััะตะน, ะดะฐะถะต ะตัะปะธ ะดะปั ััะพะณะพ ะฝัะถะฝะพ ัะฟะพัะพัััั ะธ ะฟัะธะดัะผะฐัั ะบะฐะบัั-ัะพ ะผัะปัะบั (ะฒ ะฝะฐัะตะผ ัะปััะฐะต โ ัะฒะพะน ะฑะธะฝะฐัะฝัะน ะฟัะพัะพะบะพะป ัะถะฐัะธั ะดะฐะฝะฝัั).ย

ะัะปะธ ะฒั ะฑัะดะตัะต ัะฒะตัะตะฝั ะฒ ะฒะฐัะตะน ะฐััะธัะตะบัััะต, ัะพ ัะผะพะถะตัะต ะดะพะบะฐะทะฐัั ะปัะฑะพะน ะบะพะผะฐะฝะดะต, ััะพ ะฟัะพะฑะปะตะผะฐ ะฝะต ะฝะฐ ะฒะฐัะตะน ััะพัะพะฝะต. ะขะตะผ ัะฐะผัะผ ะฟะพะผะพัั ะฝะฐะนัะธ ัะตะฐะปัะฝัะน ะฑะฐัะปะฝะตะบ, ะธะทะฑะฐะฒะธะฒัะธัั ะพั ะบะพัะพัะพะณะพ, ะบะพะผะฟะฐะฝะธั ัะผะพะถะตั ะฟะพะปััะธัั ะฑะพะปััะพะน ะฟัะพัะธั, ะฒ ะฝะฐัะตะผ ัะปััะฐะต โ ัะผะตะฝััะตะฝะธะต ะฒัะตะผะตะฝะธ Round Trip ะฟะพ 99 ะบะฒะฐะฝัะธะปะธย**ะฒ ัะตะผั ัะฐะท**. ย

ะะฐ ัะตัััะต ะณะพะดะฐ ะผั ะฟัะพัะปะธ ะพะณัะพะผะฝัะน ะฟััั ะพั ะดะฒัั ะดะพ 100 ัะบัะฟะตัะธะผะตะฝัะพะฒ ะฒ ะผะตััั. ะั ะฝะต ัะฐะท ะพะฟัะธะผะธะทะธัะพะฒะฐะปะธ ะฝะฐัั ะฟะปะฐััะพัะผั, ะพะฟะตัะฐัะธะฒะฝะพ ัะตัะฐะปะธ ะฟัะพะฑะปะตะผั ะณะพัััะตะณะพ ะฟัะพะดะฐะบัะตะฝะฐ, ะผะตะฝัะปะธ ะฟัะพัะตััั ะธ ะฟัะธะดัะผัะฒะฐะปะธ ะธะฝะฝะพะฒะฐัะธะพะฝะฝัะต ัะตัะตะฝะธั. ะฅะพัั ัะบะฐะทะฐัั ะฑะพะปััะพะต ัะฟะฐัะธะฑะพ ะฒัะตะผ ะฑัะบะตะฝะดะตัะฐะผ, ัะธะผะปะธะดะฐะผ, ะฟัะพะดัะบั ะพัะฝะตัะฐะผ, ัะตััะธัะพะฒัะธะบะฐะผ, ััะพะฝัะตะฝะดะตัะฐะผ, ะดะธะทะฐะนะฝะตัะฐะผ, ะฐะฝะฐะปะธัะธะบะฐะผ, ะบะพัะพััะต ะฒะปะพะถะธะปะธ ัะฒะพั ะดััั ะฒ ะฝะฐัั ะฟะปะฐััะพัะผั ะ/B-ัะตััะพะฒ, ะฟัะพะดะพะปะถะฐัั ะตั ะฟะธะปะธัั ะธ ัะพะฒะตััะตะฝััะฒะพะฒะฐัั. ะขะฐะบะถะต ะพัะดะตะปัะฝะพะต ัะฟะฐัะธะฑะพ ััะบะพะฒะพะดััะฒั ะทะฐ ะดะพะฒะตัะธะต ะธ ะฝะฐััะฐะฒะฝะธัะตััะฒะพ.ย

ะะฐัะฐ ะบะพะผะฐะฝะดะฐ ะฑะปะฐะณะพะดะฐัั ะบะพะผะฐะฝะดะต ะฒะฐะปะธะดะฐัะธะธ, ะฟัะตะบัะฐัะฝะพะผั ะฟัะพะดัะบั ะพัะฝะตัั ะธ ะฝะฐัะตะผั CTOย[@AntonStepanenko](https://habr.com/users/antonstepanenko)ยะฟะธะปะธั ะพัะตะฝั ะธะฝัะตัะตัะฝัะต ะธะฝััััะผะตะฝัั ะ/B-ัะตััะธัะพะฒะฐะฝะธั, ะพ ะบะพัะพััั, ะฝะฐะดะตััั, ะผั ัะฐััะบะฐะถะตะผ ะฒ ัะปะตะดัััะธั ััะฐัััั.